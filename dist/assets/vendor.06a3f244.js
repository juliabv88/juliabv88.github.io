var Ea=Object.defineProperty,Oa=Object.defineProperties;var Pa=Object.getOwnPropertyDescriptors;var Ut=Object.getOwnPropertySymbols;var fi=Object.prototype.hasOwnProperty,gi=Object.prototype.propertyIsEnumerable;var pi=(e,t,r)=>t in e?Ea(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t)=>{for(var r in t||(t={}))fi.call(t,r)&&pi(e,r,t[r]);if(Ut)for(var r of Ut(t))gi.call(t,r)&&pi(e,r,t[r]);return e},re=(e,t)=>Oa(e,Pa(t));var jt=(e,t)=>{var r={};for(var i in e)fi.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&Ut)for(var i of Ut(e))t.indexOf(i)<0&&gi.call(e,i)&&(r[i]=e[i]);return r};const zi="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function Yi(e){let t=e+"_";for(let r=0;r<22;++r)t+=zi.charAt(Math.random()*62>>>0);return t}function Ca(e){let t=0;for(let i=0,s=e.length;i<s;++i)t=Math.imul(31,t)+e.charCodeAt(i)>>>0;if(t==0)return"0";let r="";for(;t>0;)r+=zi.charAt(t%62),t=t/62>>>0;return r}let Lt;function Nr(){if(Lt)return Lt;try{return Lt=xa(location.href)}catch(e){console.error("Failed to decode payload",e),de.track("PayloadDecodeError",{url:location.href})}return Lt={}}function xa(e){const t=new URL(e),i=new URL(t.hash.substring(1),t.origin).searchParams.get("link");if(i)return JSON.parse(i)||{};try{return JSON.parse(decodeURIComponent(t.hash.substring(1)))}catch{}return{}}function Ra(e){const t=new URL(location.href),r=new URL(t.hash.substring(1),t.origin);return r.searchParams.set("link",JSON.stringify(e)),t.hash=r.pathname+r.search,t.toString()}function nc(){return Nr().data}function $a(e){const t=new URL(e),r=new URL(t.hash.substring(1),t.origin);return r.searchParams.has("link")&&(r.searchParams.delete("link"),t.hash=r.pathname+r.search,t.hash=="#/"&&(t.hash="")),t.searchParams.delete("payload"),t.toString()}class Na{constructor(t){this.localStorage=t}async onLogin(t){this.replicantClient=t;for(const i in t.storage.get())return;const r={};for(const i of await this.localStorage.getAllKeys()){const s=await this.localStorage.get(i);r[i]=s}await t.storage.set(r),this.localStorage.clear()}set(t,r){return this.replicantClient&&this.replicantClient.isLoggedIn()?this.replicantClient.storage.set({[t]:r}):this.localStorage.set(t,r)}get(t){return this.replicantClient&&this.replicantClient.isLoggedIn()?Promise.resolve(this.replicantClient.storage.get()[t]):this.localStorage.get(t)}remove(t){return this.replicantClient&&this.replicantClient.isLoggedIn()?this.replicantClient.storage.remove([t]):this.localStorage.remove(t)}}function mi(e){return new Promise((t,r)=>{e.onsuccess=()=>{t(e.result)},e.onerror=()=>{r(e.error)}})}class Ji{constructor(t){this.internal=t;const r=indexedDB.open("Playpass",1);r.onupgradeneeded=()=>{const i=r.result;i.createObjectStore("Internal"),i.createObjectStore("Game")},this.db=mi(r)}set(t,r){return this.callStore("readwrite",i=>i.put(r,t))}get(t){return this.callStore("readonly",r=>r.get(t))}getAllKeys(){return this.callStore("readonly",t=>t.getAllKeys())}clear(){return this.callStore("readwrite",t=>t.clear())}remove(t){return this.callStore("readwrite",r=>r.delete(t))}async callStore(t,r){const i=await this.db,s=this.internal?"Internal":"Game",a=i.transaction(s,t).objectStore(s),o=r(a);return mi(o)}}const Qi=new Na(new Ji(!1)),ac=Qi,je=new Ji(!0);let Gt;async function Ma(){Gt=await je.get("featureFlags")||{};const e=Nr();if(e.featureFlags){for(const t in e.featureFlags)Gt[t]=!!e.featureFlags[t];je.set("featureFlags",Gt)}Da()}function Da(){de.setUserProperties({featureFlags:Gt})}var Ua=Object.create,Mr=Object.defineProperty,ja=Object.getOwnPropertyDescriptor,La=Object.getOwnPropertyNames,Fa=Object.getPrototypeOf,qa=Object.prototype.hasOwnProperty,Xt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ha=(e,t)=>{for(var r in t)Mr(e,r,{get:t[r],enumerable:!0})},Va=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of La(t))!qa.call(e,s)&&s!==r&&Mr(e,s,{get:()=>t[s],enumerable:!(i=ja(t,s))||i.enumerable});return e},Zt=(e,t,r)=>(r=e!=null?Ua(Fa(e)):{},Va(t||!e||!e.__esModule?Mr(r,"default",{value:e,enumerable:!0}):r,e)),Dr=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},L=(e,t,r)=>(Dr(e,t,"read from private field"),r?r.call(e):t.get(e)),Ft=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},ze=(e,t,r,i)=>(Dr(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),z=(e,t,r)=>(Dr(e,t,"access private method"),r),Ba=Xt((e,t)=>{(function(r,i){typeof e=="object"&&typeof t<"u"?t.exports=i():typeof define=="function"&&define.amd?define(i):(r=typeof globalThis<"u"?globalThis:r||self,r["fast-copy"]=i())})(e,function(){var r=Function.prototype.toString,i=Object.create,s=Object.defineProperty,a=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,u=Object.getPrototypeOf,p=Object.prototype,g=p.hasOwnProperty,f=p.propertyIsEnumerable,y={SYMBOL_PROPERTIES:typeof h=="function",WEAKMAP:typeof WeakMap=="function"},b=function(){if(y.WEAKMAP)return new WeakMap;var S=i({has:function(C){return!!~S._keys.indexOf(C)},set:function(C,q){S._keys.push(C),S._values.push(q)},get:function(C){return S._values[S._keys.indexOf(C)]}});return S._keys=[],S._values=[],S},E=function(S,C){if(!S.constructor)return i(null);var q=S.constructor,k=S.__proto__||u(S);if(q===C.Object)return k===C.Object.prototype?{}:i(k);if(~r.call(q).indexOf("[native code]"))try{return new q}catch{}return i(k)},P=function(S,C,q,k){var H=E(S,C);k.set(S,H);for(var $ in S)g.call(S,$)&&(H[$]=q(S[$],k));if(y.SYMBOL_PROPERTIES){var _=h(S),D=_.length;if(D)for(var M=0,O=void 0;M<D;M++)O=_[M],f.call(S,O)&&(H[O]=q(S[O],k))}return H},T=function(S,C,q,k){var H=E(S,C);k.set(S,H);var $=y.SYMBOL_PROPERTIES?o(S).concat(h(S)):o(S),_=$.length;if(_){for(var D=0,M=void 0,O=void 0;D<_;D++)if(M=$[D],M!=="callee"&&M!=="caller")if(O=a(S,M),O){!O.get&&!O.set&&(O.value=q(S[M],k));try{s(H,M,O)}catch{H[M]=O.value}}else H[M]=q(S[M],k)}return H},K=function(S){var C="";return S.global&&(C+="g"),S.ignoreCase&&(C+="i"),S.multiline&&(C+="m"),S.unicode&&(C+="u"),S.sticky&&(C+="y"),C},J=Array.isArray,te=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;console&&console.error&&console.error('Unable to locate global object, returning "this".')}();function ie(S,C){var q=!!(C&&C.isStrict),k=C&&C.realm||te,H=q?T:P,$=function(_,D){if(!_||typeof _!="object")return _;if(D.has(_))return D.get(_);var M=_.constructor;if(M===k.Object)return H(_,k,$,D);var O;if(J(_)){if(q)return T(_,k,$,D);var sr=_.length;O=new M,D.set(_,O);for(var He=0;He<sr;He++)O[He]=$(_[He],D);return O}if(_ instanceof k.Date)return new M(_.getTime());if(_ instanceof k.RegExp)return O=new M(_.source,_.flags||K(_)),O.lastIndex=_.lastIndex,O;if(k.Map&&_ instanceof k.Map)return O=new M,D.set(_,O),_.forEach(function(ct,nr){O.set(nr,$(ct,D))}),O;if(k.Set&&_ instanceof k.Set)return O=new M,D.set(_,O),_.forEach(function(ct){O.add($(ct,D))}),O;if(k.Blob&&_ instanceof k.Blob)return _.slice(0,_.size,_.type);if(k.Buffer&&k.Buffer.isBuffer(_))return O=k.Buffer.allocUnsafe?k.Buffer.allocUnsafe(_.length):new M(_.length),D.set(_,O),_.copy(O),O;if(k.ArrayBuffer){if(k.ArrayBuffer.isView(_))return O=new M(_.buffer.slice(0)),D.set(_,O),O;if(_ instanceof k.ArrayBuffer)return O=_.slice(0),D.set(_,O),O}return typeof _.then=="function"||_ instanceof Error||k.WeakMap&&_ instanceof k.WeakMap||k.WeakSet&&_ instanceof k.WeakSet?_:H(_,k,$,D)};return $(S,b())}return ie.default=ie,ie.strict=function(S,C){return ie(S,{isStrict:!0,realm:C?C.realm:void 0})},ie})}),Ga=Xt((e,t)=>{t.exports=function r(i,s){if(i===s)return!0;if(i&&s&&typeof i=="object"&&typeof s=="object"){if(i.constructor!==s.constructor)return!1;var a,o,h;if(Array.isArray(i)){if(a=i.length,a!=s.length)return!1;for(o=a;o--!==0;)if(!r(i[o],s[o]))return!1;return!0}if(i.constructor===RegExp)return i.source===s.source&&i.flags===s.flags;if(i.valueOf!==Object.prototype.valueOf)return i.valueOf()===s.valueOf();if(i.toString!==Object.prototype.toString)return i.toString()===s.toString();if(h=Object.keys(i),a=h.length,a!==Object.keys(s).length)return!1;for(o=a;o--!==0;)if(!Object.prototype.hasOwnProperty.call(s,h[o]))return!1;for(o=a;o--!==0;){var u=h[o];if(!r(i[u],s[u]))return!1}return!0}return i!==i&&s!==s}}),Wa=Xt(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InMemoryStorageAdapter=void 0;var t=function(){function r(i){this.storage=i,this.cache=new Map}return Object.defineProperty(r.prototype,"length",{get:function(){return this.storage.length},enumerable:!1,configurable:!0}),r.prototype.clear=function(){this.cache.clear(),this.storage.clear()},r.prototype.getItem=function(i){var s=this.storage.getItem(i);return typeof s<"u"&&s!==null?(this.cache.set(i,s),s):this.cache.has(i)?this.cache.get(i):s},r.prototype.key=function(i){return this.storage.key(i)},r.prototype.removeItem=function(i){this.cache.delete(i),this.storage.removeItem(i)},r.prototype.setItem=function(i,s){this.cache.set(i,s),this.storage.setItem(i,s)},r}();e.InMemoryStorageAdapter=t}),Xi=Xt(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.localStorage=e.getLocalStorage=e.isLocalStorageAvailable=void 0;var t=Wa(),r={length:0,clear:function(){},getItem:function(){return null},key:function(){return null},removeItem:function(){},setItem:function(){}};function i(){try{var a=new Date().toString();window.localStorage.setItem(a,a);var o=window.localStorage.getItem(a)===a;return window.localStorage.removeItem(a),o}catch{return!1}}e.isLocalStorageAvailable=i;function s(){return typeof window<"u"&&i()?window.localStorage:r}e.getLocalStorage=s,e.localStorage=new t.InMemoryStorageAdapter(s())}),Ka=class{constructor(){this.migrations=[]}addMigration(e,t){if(e!==this.migrations.length+1)throw new Error("Migration version "+e+" not consecutive!");this.migrations.push(t)}getLatestVersion(){return this.migrations.length+1}applyMigration(e,t){let r=t-1;if(r<0||r>=this.migrations.length)throw new Error("Invalid migrationIndex: "+r+" when trying to migrate to version "+t);this.migrations[r](e)}},Zi={};Ha(Zi,{ArraySchema:()=>ds,BooleanSchema:()=>cs,IntegerSchema:()=>ls,NumberSchema:()=>tr,ObjectSchema:()=>us,Schema:()=>me,StringSchema:()=>hs,TupleSchema:()=>ps,UnionSchema:()=>fs,UnknownSchema:()=>gs,array:()=>mo,boolean:()=>po,float:()=>ho,int:()=>uo,map:()=>yo,number:()=>co,object:()=>go,string:()=>lo,tuple:()=>bo,union:()=>fo,unknown:()=>ms});function ot(e){return e[0]==="Err"}function Fe(e){return e[0]==="Ok"}var fe=e=>["Ok",e],W=e=>["Err",e],It=e=>["DecodeError",e],pe=(e,t)=>["TypeMismatch",e,t],za=(e,t)=>["ErrorAtIndex",e,t],es=(e,t)=>["ErrorAtProperty",e,t],Ur=e=>()=>fe(e),ts=e=>()=>W([It(e)]),Ya=()=>W([]),rs=fe,Ja=e=>typeof e=="boolean"?fe(e):W([pe("boolean",typeof e)]),is=e=>typeof e=="string"?fe(e):W([pe("string",typeof e)]),Qa=e=>typeof e!="number"?W([pe("number",typeof e)]):Number.isFinite(e)?fe(e):W([pe("number",e.toString())]),Xa=e=>typeof e!="number"?W([pe("integer",typeof e)]):Number.isInteger(e)?fe(e):W([pe("integer",e.toString())]),Za=(e,t)=>r=>{let i=e(r);return ot(i)?i:fe(t(i[1]))},eo=(e,t)=>r=>{let i=e(r);if(Fe(i))return i;let s=t(r);return Fe(s)?s:W(i[1].concat(s[1]))},Yt=(e,t)=>r=>{let i=e(r);return ot(i)?i:t(i[1])(r)},to=e=>t=>{if(!Array.isArray(t))return W([pe("array",typeof t)]);let r=e,i=new Array(t.length),s=[],a;for(let o=0;o<t.length;o++)a=r(t[o]),Fe(a)?i[o]=a[1]:s.push(...a[1].map(h=>za(o,h)));return s.length?W(s):fe(i)},ss=e=>t=>{if(typeof t!="object")return W([pe("object",typeof t)]);if(t===null)return W([pe("object","null")]);let r=t,i=e,s={},a=[];for(let o in r)if(Object.prototype.hasOwnProperty.call(r,o)){let h=i(r[o]);Fe(h)?s[o]=h[1]:a.push(...h[1].map(u=>es(o,u)))}return a.length?W(a):fe(s)},ro=e=>t=>{if(typeof t!="object")return W([pe("object",typeof t)]);if(t===null)return W([pe("object","null")]);let r=t,i={},s=[];for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a)){let o=(0,e[a])(r[a]);Fe(o)?typeof o[1]<"u"&&(i[a]=o[1]):s.push(...o[1].map(h=>es(a,h)))}return s.length?W(s):fe(i)},ns=(e,t)=>r=>{let i=t(r);return ot(i)?i:i[1]<e?W([It("Unexpected value: expected >= "+e+", found "+i[1])]):i},as=(e,t)=>r=>{let i=t(r);return ot(i)?i:i[1]>e?W([It("Unexpected value: expected <= "+e+", found "+i[1])]):i},io=(e,t)=>r=>{let i=t(r);return ot(i)?i:i[1].length<e?W([It("Unexpected value: expected .length >= "+e+", found "+i[1].length)]):i},so=(e,t)=>r=>{let i=t(r);return ot(i)?i:i[1].length>e?W([It("Unexpected value: expected .length <= "+e+", found "+i[1].length)]):i};function er(e,t){return e(t)}function Or(e){switch(e[0]){case"DecodeError":return e[1];case"ErrorAtIndex":return"Error at array index  "+e[1]+": "+Or(e[2]);case"ErrorAtProperty":return"Error at property "+e[1]+": "+Or(e[2]);case"TypeMismatch":return"Type mismatch: expected "+e[1]+", found "+e[2]}}var no=Zt(Ba()),ao=Zt(Ga());function Jt(e,t){if(typeof t=="object"&&Array.isArray(t)){if(typeof e!="object"||!Array.isArray(e))return ee(t);let r=!1,i=[...t];for(let s=0;s<t.length;s++){let a=Jt(e[s],t[s]);a!==e[s]&&(r=!0),i[s]=a}return t.length!==e.length&&(r=!0),r?i:e}if(typeof t=="object"){if(typeof e!="object")return ee(t);let r=!1,i=I({},t);for(let s in t){let a=Jt(e[s],t[s]);a!==e[s]&&(r=!0),i[s]=a}for(let s in e)if(!(s in t)){r=!0;break}return r?i:e}return t!==e?t:e}function ee(e){return(0,no.default)(e)}function os(e,t){return(0,ao.default)(e,t)}function Ue(e,t){let r={};for(let i in e)r[i]=t(i,e[i]);return r}var me=class{constructor(){this.__schema=!0,this.required=!0,this.defaultValueSet=!1,this.customValidatorFn=()=>null}isArraySchema(){return this._type==="array"}isObjectSchema(){return this._type==="object"}optional(){return this.required=!1,this}default(e){return this.tryValidate(e),this.defaultValue=e,this.defaultValueSet=!0,this}customValidator(e){return this.customValidatorFn=e,this}getDefault(){if(this.tryValidate(this.defaultValue),!(!this.required&&!this.defaultValueSet))return ee(this.defaultValue)}tryValidate(e,t){let r=this.validate(e,t);if(r)throw new Error(r)}validate(e,t){return this.validateType(e,t)||(this.required||e!==void 0?this.customValidatorFn(e,t):null)}isValid(e){return!this.validate(e)}tryValidateAndFillDefaults(e,t){return e===void 0&&this.required?this.getDefault():(this.tryValidate(e,t),null)}tryDecode(e){let t=er(this.toDecoder(),e);if(Fe(t))return t[1];throw new Error(t[1].map(Or).join(`
`))}},tr=class extends me{constructor(){super(),this._type="number",this.minVal=-1/0,this.maxVal=1/0,this.defaultValue=0}range(e,t){return this.minVal=e,this.maxVal=t,this}min(e){return this.minVal=e,this}max(e){return this.maxVal=e,this}validateType(e){return e===void 0&&!this.required?null:typeof e!="number"?"Not a number: "+e:this.minVal>e||this.maxVal<e?"Out of range: "+e+" in range ["+this.minVal+", "+this.maxVal+"]":isNaN(e)?"Value is NaN":null}serialize(){return{type:"number",optional:!this.required}}toDecoder(){let e=Qa;return e=ns(this.minVal,e),e=as(this.maxVal,e),Ie(this,e)}},ls=class extends tr{constructor(){super(),this._type="integer"}validateType(e){return e===void 0&&!this.required?null:super.validateType(e)||(parseInt(e.toString(),10)!==e?"Not an integer":null)}toDecoder(){let e=Xa;return e=ns(this.minVal,e),e=as(this.maxVal,e),Ie(this,e)}},cs=class extends me{constructor(){super(),this._type="boolean",this.defaultValue=!1}validateType(e){return e===void 0&&!this.required?null:typeof e!="boolean"?"Not a boolean":null}serialize(){return{type:"boolean",optional:!this.required}}toDecoder(){return Ie(this,Ja)}},hs=class extends me{constructor(){super(),this._type="string",this.defaultValue=""}validateType(e){return e===void 0&&!this.required||typeof e=="string"?null:"Not a string: "+e}serialize(){return{type:"string",optional:!this.required}}toDecoder(){return Ie(this,is)}},us=class extends me{constructor(e){var t;super(),this._type="object",this.objValidators=e;for(let r in e)if(typeof e[r]!="object"||!((t=e[r])!=null&&t.__schema))throw new Error("Schema for field "+r+" not constructed by SchemaBuilder.")}validateType(e,t){if(e===void 0&&!this.required)return null;if(typeof e!="object"||e===null)return"Not an object: "+e;for(let i in e){let s=this.objValidators[i],a=t&&!!t.ignoreUnexpectedFields;if(!s){if(a)continue;if(!this.additionalPropertyValuesSchema)return"Unexpected field: "+i;s=this.additionalPropertyValuesSchema}let o=s.validate(e[i],t);if(o)return"Error validating field `"+i+"`: "+o}let r=Object.keys(this.objValidators).filter(i=>this.objValidators[i].required).filter(i=>typeof e[i]>"u");return r.length>0?"Missing fields: "+r.join(", "):null}tryValidateAndFillDefaults(e,t){if(e===void 0&&!this.required)return null;if(typeof e!="object"||e===null)throw new Error("Not an object.");let r=!1;for(let s in e){let a=this.objValidators[s],o=t&&!!t.ignoreUnexpectedFields;if(!a){if(o)continue;if(!this.additionalPropertyValuesSchema)throw new Error("Unexpected field: "+s);a=this.additionalPropertyValuesSchema}let h;try{h=a.tryValidateAndFillDefaults(e[s],t)}catch(u){throw new Error("Error validating field `"+s+"`: "+u.message)}h&&(r||(e=ee(e),r=!0),e[s]=h)}let i=Object.keys(this.objValidators).filter(s=>this.objValidators[s].required).filter(s=>typeof e[s]>"u");for(let s of i)r||(e=ee(e),r=!0),e[s]=this.objValidators[s].getDefault();return r?e:null}getDefault(){if(!this.required&&!this.defaultValueSet)return;let e;return this.defaultValue?e=this.defaultValue:e=Object.keys(this.objValidators).map(t=>({[t]:this.objValidators[t].getDefault()})).reduce((t,r)=>I(I({},t),r),{}),this.tryValidate(e),ee(e)}serialize(){let e={};for(let t in this.objValidators)e[t]=this.objValidators[t].serialize();return{type:"object",optional:!this.required,fields:e}}getSchema(e){return this.objValidators[e]}getFullSchema(){return this.objValidators}additionalProperties(e){return this.additionalPropertyValuesSchema=e||ms(),this}toDecoder(){let e={};Object.entries(this.objValidators).forEach(([r,i])=>{e[r]=i.toDecoder()});let t=ro(e);if(this.additionalPropertyValuesSchema){let r=this.additionalPropertyValuesSchema.toDecoder();t=Yt(t,i=>Yt(ss(rs),s=>{let a={},o;return Object.entries(s).forEach(([h,u])=>{o=er(r,u),Fe(o)&&(a[h]=o[1])}),Ur(I(I({},a),i))}))}return Ie(this,t)}},ds=class extends me{constructor(e){if(super(),this._type="array",this.minLengthVal=-1/0,this.maxLengthVal=1/0,this.defaultValue=[],this.itemSchema=e,typeof e!="object"||!e.__schema)throw new Error("Item schema for array not constructed by SchemaBuilder")}lengthRange(e,t){return this.minLengthVal=e,this.maxLengthVal=t,this}minLength(e){return this.minLengthVal=e,this}maxLength(e){return this.maxLengthVal=e,this}length(e){return this.minLengthVal=this.maxLengthVal=e,this}validateType(e,t){var r;if(e===void 0&&!this.required)return null;if(typeof e!="object"||!Array.isArray(e))return"Not an array "+e;if(this.minLengthVal>e.length||this.maxLengthVal<e.length)return`Length out of range: ${e.length} in range [${this.minLengthVal}, ${this.maxLengthVal}]`;for(let i=0;i<e.length;i++){let s=(r=e[i])!=null?r:void 0,a=this.itemSchema.validate(s,t);if(a)return"Error validating item "+i+": "+a}return null}tryValidateAndFillDefaults(e,t){var i;if(e===void 0&&!this.required)return null;let r=!1;for(let s=0;s<e.length;s++){let a=(i=e[s])!=null?i:void 0,o;try{o=this.itemSchema.tryValidateAndFillDefaults(a,t)}catch(h){throw new Error("Error validating item "+s+": "+h.message)}o!==null&&(r||(e=ee(e)),e[s]=o,r=!0)}return this.tryValidate(e,t),r?e:null}getDefault(){if(!(!this.required&&!this.defaultValueSet))return this.tryValidate(this.defaultValue),ee(this.defaultValue)}serialize(){return{type:"array",optional:!this.required,items:this.itemSchema.serialize()}}getItemSchema(){return this.itemSchema}toDecoder(){let e=this.itemSchema.toDecoder(),t=to(r=>er(e,r!=null?r:void 0));return t=io(this.minLengthVal,t),t=so(this.maxLengthVal,t),Ie(this,t)}},ps=class extends me{constructor(e){if(super(),this.values=e,this._type="tuple",e.length===0)throw new Error("Tuple schema requires at least one string literal type.")}validateType(e){return e===void 0&&!this.required||this.values.includes(e)?null:e+" is not valid, possible values: "+this.values.join(", ")}getDefault(){if(!(!this.required&&!this.defaultValueSet))return this.defaultValueSet?this.defaultValue:this.values[0]}serialize(){return{type:"tuple",optional:!this.required,values:this.values}}toDecoder(){let e=Yt(is,t=>this.values.includes(t)?Ur(t):ts("Expected one of { "+this.values.map(r=>JSON.stringify(r)).join(", ")+" }"));return Ie(this,e)}},oo=class extends me{constructor(e){if(super(),this._type="map",this.itemSchema=e,typeof e!="object"||!e.__schema)throw new Error("Item schema for array not constructed by SchemaBuilder");this.defaultValue={}}validateType(e,t){if(e===void 0&&!this.required)return null;if(typeof e!="object"||e===null)return"Not a map: "+e;for(let r in e){let i=this.itemSchema.validate(e[r],t);if(i)return'Error validating item in map with key "'+r+'": '+i}return null}tryValidateAndFillDefaults(e,t){if(this.required&&e===void 0)return this.getDefault();if(e===void 0&&!this.required)return null;if(typeof e!="object"||e===null)return"Not a map: "+e;let r=!1;for(let i in e){let s;try{s=this.itemSchema.tryValidateAndFillDefaults(e[i],t)}catch(a){throw new Error('Error validating item in map with key "'+i+'": '+a.message)}s&&(r||(e=ee(e)),e[i]=s,r=!0)}return r?e:null}getDefault(){if(!(!this.required&&!this.defaultValueSet))return this.tryValidate(this.defaultValue),ee(this.defaultValue)}serialize(){return{type:"map",optional:!this.required,items:this.itemSchema.serialize()}}toDecoder(){let e=ss(this.itemSchema.toDecoder());return Ie(this,e)}},fs=class extends me{constructor(e){if(super(),this._type="union",e.length===0)throw new Error("Cannot define empty union type");this.itemSchemas=e}validateType(e,t){if(e===void 0&&!this.required)return null;let r=[];for(let i of this.itemSchemas){let s=i.validate(e,t);if(s)r.push("Could not validate value as "+i.constructor.name+": "+s);else return null}return r.join(`
`)}getDefault(){if(!(!this.required&&!this.defaultValueSet))return this.defaultValueSet?this.defaultValue:this.itemSchemas[0].getDefault()}tryValidateAndFillDefaults(e,t){if(this.required&&e===void 0)return this.getDefault();if(e===void 0&&!this.required||!this.validate(e,t))return null;let r=[];for(let i of this.itemSchemas)try{return i.tryValidateAndFillDefaults(e,t)}catch(s){r.push(s)}throw new Error("Could not validate union: "+r.join(","))}serialize(){return{type:"union",optional:!this.required,variants:this.itemSchemas.map(e=>e.serialize())}}toDecoder(){let e=[...this.itemSchemas].reverse().reduce((t,r)=>eo(r.toDecoder(),t),Ya);return Ie(this,e)}},gs=class extends me{constructor(){return super(),this._type="unknown",this.optional()}validateType(e){return null}serialize(){return{type:"unknown",optional:!this.required}}toDecoder(){return Za(rs,ee)}};function lo(){return new hs}function co(){return new tr}function ho(){return new tr}function uo(){return new ls}function po(){return new cs}function fo(e){return new fs(e)}function go(e){return new us(e)}function mo(e){return new ds(e)}function yo(e){return new oo(e)}function bo(e){return new ps(e)}function ms(){return new gs}var Ie=(e,t)=>{let r=e.customValidatorFn;return r&&(t=Yt(t,i=>{let s=r(i);return s?ts(s):Ur(i)})),i=>typeof i>"u"?fe(e.getDefault()):er(t,i)},c=Zi;function vo(e,t){switch(e){case"fb":case"line":case"link":case"snapchat":case"viber":case"zoom":case"tiktok":case"mock":return e;default:if(t)return t;throw new Error("Unsupported platform: "+e)}}function Qe(e=Math.random){return e().toString(36).substr(2,9)}function _o(){try{return{}.STAGE}catch{return}}function yi(e){throw new Error(`Invalid value: '${e}'`)}function ue({days:e=0,hours:t=0,minutes:r=0,seconds:i=0,ms:s=0}){return s+i*1e3+r*6e4+t*36e5+e*864e5}function So(e){let t;try{t=JSON.parse(JSON.stringify(e))}catch{return!1}return os(t,e)}var wo="web_",br="_heartbeat",bi="_applyMessages",Ao=ue({seconds:30}),Io=ue({seconds:90}),ys=ue({seconds:30}),et={network_error:"network_error",replication_error:"replication_error",version_error:"version_error",session_desync_error:"session_desync_error",authorization_error:"authorization_error",server_error:"server_error",unknown_error:"unknown_error"},bs={audience_mismatch:"audience_mismatch",id_mismatch:"id_mismatch",invalid_platform:"invalid_platform",invalid_otp_code:"invalid_otp_code",invalid_otp_receiver:"invalid_otp_receiver",invalid_scope:"invalid_scope",invalid_signature:"invalid_signature",token_expired:"token_expired"},To=re(I({},bs),{action_args_too_large:"action_args_too_large",analytics_user_properties_error:"analytics_user_properties_error",db_error:"db_error",exceeded_message_reduction_threshold:"exceeded_message_reduction_threshold",gender_inference_error:"gender_inference_error",index_doc_too_large:"index_doc_too_large",invalid_ecpm:"invalid_ecpm",invalid_state:"invalid_state",invalid_action:"invalid_action",invalid_message:"invalid_message",invalid_phone_number:"invalid_phone_number",message_args_too_large:"message_args_too_large",missing_messages:"missing_messages",client_time_invalid:"client_time_invalid",client_time_offset_too_large:"client_time_offset_too_large",random_seed_invalid:"random_seed_invalid",message_errored:"message_errored",async_action_api_error:"async_action_api_error",delayed_actions_error:"delayed_actions_error",async_getter_error:"async_getter_error",payment_signature_verification_error:"payment_signature_verification_error",payment_already_purchased_error:"payment_already_purchased_error",scheduled_action_args_too_large:"scheduled_action_args_too_large",shared_state_message_args_too_large:"shared_state_message_args_too_large",user_asset_upload_error:"user_asset_upload_error",scheduled_actions_error:"scheduled_actions_error",key_value_storage_error:"key_value_storage_error",admin_interface_error:"admin_interface_error",user_login_error:"user_login_error",payload_too_large:"payload_too_large",state_too_large:"state_too_large",rev_id_mismatch:"rev_id_mismatch",request_replayed:"request_replayed",retry_queue_mismatch:"retry_queue_mismatch",invoking_while_out_of_sync:"invoking_while_out_of_sync",push_notification_error:"push_notification_error",search_error:"search_error",ab_tests_error:"ab_tests_error",chatbot_receiver_not_found:"chatbot_receiver_not_found",chatbot_missing_player:"chatbot_missing_player",chatbot_missing_receiver:"chatbot_missing_receiver",chatbot_missing_sender:"chatbot_missing_sender",chatbot_missing_configuration:"chatbot_missing_configuration",chatbot_missing_asset:"chatbot_missing_asset",chatbot_missing_asset_url:"chatbot_missing_asset_url",chatbot_send_error:"chatbot_send_error",fb_comment_retrieval_error:"fb_comment_retrieval_error",webhook_referral_url_not_set:"webhook_referral_url_not_set",webhook_referral_player_not_found:"webhook_referral_player_not_found",webhook_postback_missing_params:"webhook_postback_missing_params",payment_subscription_invalid_otp:"payment_subscription_invalid_otp"}),F=class extends Error{constructor(e,t,r,i,s){super(e),this.code=t,this.subCode=r,this.severity=i,this.extras=s,this.name="ReplicantError"}},ko=()=>{let e=new WeakSet;return(t,r)=>{if(typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},Eo=e=>e instanceof Error?e:JSON.stringify(e,ko(),4),he;(function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.log=2]="log",e[e.warn=3]="warn",e[e.error=4]="error",e[e.fatal=5]="fatal"})(he||(he={}));var vs=he.info,We=(e,t)=>(t||(t=he[e]),(...r)=>{e>=vs&&console[t].apply(null,r.map(i=>typeof i=="object"?Eo(i):i))}),Oo={debug:We(he.debug,"log"),info:We(he.info),log:We(he.log),warn:We(he.warn),error:We(he.error),fatal:We(he.fatal,"error"),level:e=>{if(he[e]===void 0)throw new Error("Unknown log level"+e+". Please use the LogLevel enum to set it");vs=e}},tt=Oo,vi=ue({days:30}),_i=1/0;function _s(e,t){let r=vi;try{r=Number({}.APPLE_DEVICE_TOKEN_EXPIRY_IN_MS)||vi}catch{}return e+r<t}function Ss(e,t){let r=_i;try{r=Number({}.ANDROID_DEVICE_TOKEN_EXPIRY_IN_MS)||_i}catch{}return e+r<t}var Si="__serialized__",Po="__error__";function wi(e){if(typeof e=="object"&&e!==null&&e[Si]===Po){let t=e.name==="ReplicantError"?new F(e.message,e.code):Error();for(let r of Object.keys(e))r!==Si&&(t[r]=e[r]);return t}return e}function Co(e,t=-1){return t=Math.max(t,-1),r(e,0);function r(o,h){switch(typeof o){case"object":return o===null?"null":Array.isArray(o)?s(o,h):!o.constructor||o.constructor.name==="Object"?i(o,h):o.constructor.name==="RegExp"?o.toString():o.constructor.name?"[object "+o.constructor.name+"]":"[anonymous object]";case"undefined":return"undefined";case"number":if(Number.isNaN(o))return"NaN";switch(o){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return JSON.stringify(o)}case"bigint":return o.toString()+"n";case"function":return o.name?"[function "+o.name+"]":"[anonymous function]";case"symbol":return o.toString();default:return JSON.stringify(o)}}function i(o,h){let u=[];for(let p in o)o.hasOwnProperty(p)&&u.push(JSON.stringify(p)+": "+r(o[p],h+1));return a(u,"{","}",h)}function s(o,h){let u=[];for(let p of o)u.push(r(p,h+1));return a(u,"[","]",h)}function a(o,h,u,p){return o.length===0?h+u:t===-1?[h,o.join(", "),u].join(" "):[h,o.map(g=>" ".repeat(t*(p+1))+g).join(`,
`)," ".repeat(t*p)+u].join(`
`)}}function ws(e){return e.startsWith(wo)}function As(e){let t=2166136261;if(e)for(let r=0,i=e.length;r<i;r++){t=(t^e.charCodeAt(r))>>>0;let s=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);t=t+s>>>0}return t}function Is(e){let t=e.v0,r=e.v1,i=0,s=2654435769;i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>5)+2123724318,i+=s,t+=(r<<4)+2738958700^r+i^(r>>5)+3355524772,r+=(t<<4)+2911926141^t+i^(t>>5)+2123724318,e.v0=t,e.v1=r}function xo(e,t=0){typeof e=="string"&&(e=As(e)|0);let r={v0:e,v1:t};return Is(r),(r.v0&16777215)/16777216}function Ro(e,t){let r={v0:As(e),v1:t.n++};return Is(r),(r.v0&16777215)/16777216}var $o=c.object({abTests:c.map(c.object({newUsersOnly:c.boolean().optional(),assignManually:c.boolean().optional(),buckets:c.array(c.object({id:c.string()})).minLength(1)})).optional()});function Ai(e,t,r){let i=r[t].buckets,s=xo(`${e}_${t}`,0),a=Math.floor(s*i.length);return i[a].id}function qt(e,t,r){let i=t?` to bucket '${t}'`:"";throw new F(`Cannot assign test '${e}' to '${i}': ${r}`,"replication_error","ab_tests_error")}function vr(e,t){throw new F(`Cannot unassign test '${e}': ${t}`,"replication_error","ab_tests_error")}var No=class{constructor(e){this.opts=e}getBucketID(e,t){var r,i;return(i=(r=e.abTestAssignments)==null?void 0:r[t])==null?void 0:i.bucketId}assign(e,t,r,i){var h;let s=(h=this.opts.config.ruleset)==null?void 0:h.abTests;s||qt(r,i,"No ab tests have been configured."),s[r]||qt(r,i,"Not configured."),i||(i=Ai(t,r,s)),s[r].buckets.find(u=>u.id===i)||qt(r,i,"Invalid bucket."),e.abTestAssignments||(e.abTestAssignments={});let a=e.abTestAssignments[r],o=(()=>{let u=a==null?void 0:a.type;switch(u){case"automatic":return"manual-active";case"manual-active":case"manual-inactive":return u;case void 0:return"manual-inactive"}yi(u)})();e.abTestAssignments[r]=re(I({},a),{bucketId:i,type:o})}unassign(e,t,r){var a,o;let i=e.abTestAssignments;i||vr(r,"No tests assigned.");let s=i[r];switch(s||vr(r,"Test not assigned."),s.type){case"automatic":break;case"manual-active":{let h=(a=this.opts.config.ruleset)==null?void 0:a.abTests;h||vr(r,"No ab tests have been configured.");let u=Ai(t,r,h);h[r].buckets.find(p=>p.id===u)||qt(r,u,"Invalid bucket."),s.bucketId=u;break}case"manual-inactive":{(o=e.abTestAssignments)==null||delete o[r];break}default:throw yi(s.type)}}};function Mo(e){let t=Object.keys(e.newAssignments),r=Object.keys(e.oldAssignments),i=[...t,...r];return i.filter((s,a)=>i.indexOf(s)===a).map(s=>{let a=e.newAssignments[s],o=e.oldAssignments[s],h=a==null?void 0:a.bucketId,u=o==null?void 0:o.bucketId,p=!!(a!=null&&a.newUsersOnly)&&(a==null?void 0:a.type)==="automatic";return{testId:s,bucketId:h,previousBucketId:u,newUsersOnly:p}}).filter(({bucketId:s,previousBucketId:a})=>s!==a)}var Do=class{constructor(e){this.opts=e,this.clientActionsApi=new No({config:e.config}),this.assignmentsCache=ee(e.metainfo.abTestAssignments||{}),this.changeEvents=this.opts.changeEvents.slice()}getBucketID(e){return this.clientActionsApi.getBucketID(this.opts.metainfo,e)}getABTests(){return Ue(this.assignmentsCache,(e,t)=>t==null?void 0:t.bucketId)}getABTag(){return Object.keys(this.assignmentsCache).filter(e=>this.includeInABTag(e)).sort().map(e=>this.getTestTag(e)).join(",")}setOnChangedHandler(e){this.onABTestAssignmentsChanged=e,this.processChangeEvents()}handleReplicantActionCompleted(){let e=this.opts.metainfo.abTestAssignments||{};os(this.assignmentsCache,e)||(this.changeEvents.push(...Mo({newAssignments:e,oldAssignments:this.assignmentsCache})),this.assignmentsCache=ee(e),this.processChangeEvents())}processChangeEvents(){if(!this.onABTestAssignmentsChanged||!this.changeEvents.length)return;let e=this.changeEvents;this.changeEvents=[],this.onABTestAssignmentsChanged(e)}includeInABTag(e){var r;let t=(r=this.opts.config.ruleset)==null?void 0:r.abTests;return!t||!t[e]?!1:!e.startsWith("0000_placebo")}getTestTag(e){let t=this.opts.config.ruleset.abTests,r=this.getBucketID(e),i=t[e].buckets.findIndex(s=>s.id===r);return`${e.substring(0,4)}-${i}`}},Uo=["id","createdAt","updatedAt","ruleset","userSharedStates"];function Ae(e,t,r){return Object.defineProperties(e,{id:{value:t.id,configurable:!0,enumerable:!1,writable:!0},createdAt:{value:t.createdAt,configurable:!0,enumerable:!1,writable:!0},updatedAt:{value:t.updatedAt,configurable:!0,enumerable:!1,writable:!0},ruleset:{get:()=>Lo(t.metainfo),configurable:!0,enumerable:!1},userSharedStates:{get:()=>jo(r.sharedStates,t.userSharedStates),configurable:!0,enumerable:!1}}),e}function _t(e,t){return{id:e,createdAt:t.createdAt,updatedAt:t.lastUpdated,userSharedStates:t.userSharedStates,metainfo:t.metainfo}}function jo(e,t){var i;let r={};for(let s in e){if(!((i=e[s])!=null&&i.schema.user))continue;r[s]={};let a=t==null?void 0:t[s];for(let o in a){let h=a[o];!h||(r[s][o]=h.state)}}return r}function Lo(e){return{abTests:Ue(e.abTestAssignments||{},(t,r)=>r?{bucketId:r.bucketId}:void 0)}}async function Ts(e){let{clientAppName:t,devOpts:r,httpClient:i,isWebPlayable:s,onLoginActionArgs:a,otp:o,prefetchKeys:h,prefetchInternalKeys:u,sessionId:p,skipOnLoginAction:g}=e,f=(r==null?void 0:r.dateNow)||Date.now,y=f(),b=await i[s?"doLoginOrCreateWebPlayerRequest":"doLoginOrCreateRequest"](I({sid:p,skipOnLoginAction:g,prefetchKeys:h,prefetchInternalKeys:u,onLoginActionArgs:a},s?{clientAppName:t,otp:o}:{}));if(!b||!b.data)throw new F("Malformed result.",et.unknown_error);let E=f(),P=jr(y,E,b);return{data:b.data,clockOffset:P}}function jr(e,t,r){if(!r.t||typeof r.service>"u")throw new Error("Malformed server result: missing timing information");let i=r.t,s=t-e-r.service,a=i-Math.floor(s/2);return Math.floor(a-e)}var Fo=class{constructor(e){this.opts=e,this.friendsIds=[],this.friendsStates={},this.fetchFriendsTimer=void 0,this.externalFriendsStates={},this.updateLocks={},this.onFriendStatesReceivedHandlers=[],this.messages=[],this.isPaused=!1,this.timestampLastFetched=0,this.didCallSetFriendsIds=!1,this.isOffline=!1,this.pendingOnFriendsChangedCall=!1,this.fetchInterval=e.options.refreshFriendsStatesInterval||0}setFriendsIds(e){let t=!this.didCallSetFriendsIds;this.didCallSetFriendsIds=!0;let r=e.sort(),i=r.filter((s,a)=>s!==r[a+1]);return i.length===this.friendsIds.length&&this.friendsIds.every((s,a)=>s===i[a])?Promise.resolve(this.friendsStates):(this.friendsIds=i,this.fetchFriendsTimer&&clearTimeout(this.fetchFriendsTimer),this.updateFriendsStates({isResponseToFirstSetFriendsIdsFetch:t}))}getFriendsStates(){return this.externalFriendsStates}setOnFriendsStatesChangedHandler(e){this.onFriendsChanged=e}setOnErrorHandler(e){this.onErrorHandler=e}stopCheckingForUpdates(){this.isPaused=!0,this.fetchFriendsTimer&&clearTimeout(this.fetchFriendsTimer)}async fetchOtherPlayerStates(e){let t=e.filter(s=>!!this.friendsStates[s]).map(s=>({[s]:this.friendsStates[s].friendRev})).reduce((s,a)=>Object.assign(s,a),{}),r=await this.fetchStates(e,t);r&&this.handleFetchStatesResponse(r);let i={};for(let s of e)i[s]=this.friendsStates[s];return i}pause(){this.stopCheckingForUpdates()}resume(){if(this.isPaused=!1,this.fetchInterval>0){let e=this.timestampLastFetched===0?0:Math.max(this.timestampLastFetched+this.fetchInterval-Date.now(),0);this.fetchFriendsTimer&&clearTimeout(this.fetchFriendsTimer),this.fetchFriendsTimer=setTimeout(()=>this.updateFriendsStates(),e),this.pendingOnFriendsChangedCall&&this.triggerOnChangedHandlers()}}handleReplicantMessage(e,t){this.messages.push({id:e,message:t})}handleReplicantActionCompleted(e){for(let{id:r,message:i}of this.messages)this.friendsStates[r]&&(this.applyMessageToState(r,i),this.updateLocks[r]||(this.updateLocks[r]={}),this.updateLocks[r][e]=(this.updateLocks[r][e]||[]).concat([i]));let t=this.messages.length;this.messages=[],t&&(this.pendingOnFriendsChangedCall=!0,this.triggerOnChangedHandlers())}handleReplicationResultStates(e,t){for(let r in e){let i=e[r];if(Ae(i.state,_t(r,i),this.opts.config),this.friendsStates[r]=i,this.updateLocks[r])if(delete this.updateLocks[r][t],Object.keys(this.updateLocks[r]).length>0)for(let s in this.updateLocks[r])for(let a of this.updateLocks[r][s])this.applyMessageToState(r,a);else delete this.updateLocks[r]}Object.keys(e).length>0&&(this.pendingOnFriendsChangedCall=!0,this.triggerOnChangedHandlers())}clearLocks(){this.updateLocks={}}async fetchFriendsStatesNow(){return this.updateFriendsStates()}setOnFriendsStatesReceived(e){this.onFriendStatesReceivedHandlers.push(e)}clearFriendsStatesReceivedHandler(){this.onFriendStatesReceivedHandlers=[]}goOnline(){this.isOffline&&(this.isOffline=!1,this.scheduleFetchStates())}applyMessageToState(e,t){if(this.opts.config.messages){let r=this.friendsStates[e];this.opts.config.messages[t.name].reducer(r.state,t.args,{senderId:t.sender,timestamp:t.timestamp})}}async updateFriendsStates(e){let t,r=Object.keys(this.friendsStates).map(i=>({[i]:this.friendsStates[i].friendRev})).reduce((i,s)=>Object.assign(i,s),{});try{t=await this.fetchStates(this.friendsIds,r),this.timestampLastFetched=Date.now()}catch(i){tt.error("Error fetching states: ",i),this.isOffline=i.code===et.network_error,this.onErrorHandler&&this.onErrorHandler(i)}return this.isOffline||this.scheduleFetchStates(),t&&this.handleFetchStatesResponse(t,e),this.friendsStates}triggerOnChangedHandlers(e){var i;if(this.isPaused||!this.pendingOnFriendsChangedCall)return;this.pendingOnFriendsChangedCall=!1;let t=this.externalFriendsStates;this.externalFriendsStates=Jt(this.externalFriendsStates,this.friendsStates);let r=t!==this.externalFriendsStates;if(r)for(let s in this.externalFriendsStates)this.externalFriendsStates[s].state!==((i=t[s])==null?void 0:i.state)&&Ae(this.externalFriendsStates[s].state,_t(s,this.friendsStates[s]),this.opts.config);this.onFriendsChanged&&r&&this.onFriendsChanged(this.externalFriendsStates,e||{isResponseToFirstSetFriendsIdsFetch:!1})}async fetchStates(e,t){var p;let r=[],i=e.filter(g=>!(g in t)).length>100?100:300,s=e.slice(0);for(;s.length>0;){let g=s.splice(0,i);r.push({ids:g})}let a=((p=this.opts.options.devOpts)==null?void 0:p.dateNow)||Date.now,o=r.map(async g=>{let f={},y=g.ids;do{let b=a(),E=await this.opts.httpClient.doFetchStatesRequest({ids:y,friendRevs:t,consistentFetchIds:this.opts.calcConsistentFetchIds()}),P=a();if(P-b<ys){let T=jr(b,P,E);this.opts.adjustClockOffset(T)}Object.assign(f,E.data.states),y=E.data.unprocessedIds||[]}while(y.length>0);return f}),h=await Promise.all(o),u=Object.assign({},...h);for(let g in u){let f=u[g];Ae(u[g].state,_t(g,f),this.opts.config)}return u&&Object.keys(u).length>0&&(this.pendingOnFriendsChangedCall=!0),u}handleFetchStatesResponse(e,t){this.onFriendStatesReceivedHandlers.forEach(r=>r(e));for(let r in this.updateLocks)e[r]&&(e[r]=this.friendsStates[r]);this.friendsStates=I(I({},this.friendsStates),e),this.triggerOnChangedHandlers(t)}scheduleFetchStates(){!this.isPaused&&this.fetchInterval>0&&(this.fetchFriendsTimer=setTimeout(()=>this.updateFriendsStates(),this.fetchInterval))}},qo=class{constructor(e){this.opts=e}hasPhoneNumber(){return this.opts.hasPhoneNumber()}async initiateOtp(e){return this.opts.httpClient.doPostOtpInitiateAddReceiver(e)}};function ks(e){return e.purchaseHistory?e.purchaseHistory.map(t=>{let r=I({},t);return t.purchase_time.toString().length===13?(r.issued_at=Number(t.issued_at),r.purchase_time=Number(t.purchase_time)):(r.issued_at=Number(t.issued_at)*1e3,r.purchase_time=Number(t.purchase_time)*1e3),r}):[]}function Es(e){let{isAsync:t,id:r,apiMetainfo:i,chatbotMetainfo:s,invokeTime:a,messages:o,onMessagePosted:h}=e;function u(){if(!t)throw new Error("Do not use this function in a sync Replicant action.")}function p(){return null}let g=()=>i().clockOffset||0,f=Ue(o,(T,K)=>h?(J,te)=>{if(K.isAdmin)throw new Error("Cannot send admin messages from with an action."+T);K.schema.tryValidate(te),h(J,{name:T,args:te,sender:r(),timestamp:a()+g(),id:"0"})}:(J,te)=>{if(K.isAdmin)throw new Error("Cannot send admin messages from with an action."+T);K.schema.tryValidate(te)}),y=Ue(e.sharedStates,(T,K)=>{let J=K;return{create:u,fetch:u,setUserState:(te,ie)=>{var q,k,H,$,_,D,M;(q=J.schema.user)==null||q.schema.tryValidate(ie);let S=e.userSharedStates(),C={userId:r(),stateId:te,stateName:T,createdAt:($=(H=(k=S[T])==null?void 0:k[te])==null?void 0:H.createdAt)!=null?$:a(),version:0,rev:(M=(D=(_=S[T])==null?void 0:_[te])==null?void 0:D.rev)!=null?M:0,updatedAt:a(),state:ie};S[T]=re(I({},S[T]),{[te]:C})},postMessage:J.messages?Ue(J.messages,(te,ie)=>(S,C)=>{ie.schema.tryValidate(C)}):{}}}),b=Ue(e.scheduledActions,(T,{schema:K})=>({args:J})=>{K.tryValidate(J)}),E=()=>t?u():Ro(r(),i().random),P={asyncGetters:Ue(e.asyncGetters,()=>u),fetch:u,math:{random:E},getUserID:()=>r(),getSessionID:()=>e.sessionId(),date:{now:()=>(P.meta.hasUsedDateNow=!0,a()+P.getClockOffset())},fetchStates:u,flushMessages:u,kvStore:{get:u,getBatch:u,send:u,sendBatch:u},getMentionCountForPagePost:u,abTests:{getBucketID:T=>e.abTestsApiAccess().getBucketID(i(),T),assign:(T,K)=>{e.abTestsApiAccess().assign(i(),r(),T,K)},unassign:T=>{e.abTestsApiAccess().unassign(i(),r(),T)}},otp:{verifyOtp:u},postMessage:f,scheduledActions:{schedule:b,unschedule:p,rescheduleAllBy:p},payments:{createInvoice:u},paymentSubscriptions:{initiate:u,initiateWithOTPVerification:u,verify:u,verifyOTP:u,getStatus:u,cancel:u},searchPlayers:u,countPlayers:u,purchases:{getPurchaseHistory:()=>ks(i()),validatePurchase:u},sendAnalyticsEvents:p,reportError:p,sharedStates:y,meta:{hasUsedDateNow:!1,apiMetainfo:i,userSharedStates:e.userSharedStates},chatbot:{sendMessage:p,validateSubscription:p,unsubscribe:p,setAppleDeviceToken:T=>{s.appleDeviceToken=T,s.appleDeviceTokenUpdatedAt=P.date.now()},getAppleDeviceTokenUpdatedAt:()=>s.appleDeviceTokenUpdatedAt||0,appleDeviceTokenIsValid:()=>!(s.appleDeviceTokenUpdatedAt&&_s(s.appleDeviceTokenUpdatedAt,P.date.now()))&&!!s.appleDeviceToken,setAndroidDeviceToken:T=>{s.androidDeviceToken=T,s.androidDeviceTokenUpdatedAt=P.date.now()},getAndroidDeviceTokenUpdatedAt:()=>s.androidDeviceTokenUpdatedAt||0,androidDeviceTokenIsValid:()=>!(s.androidDeviceTokenUpdatedAt&&Ss(s.androidDeviceTokenUpdatedAt,P.date.now()))&&!!s.androidDeviceToken,setEmail:T=>{s.email=T}},generateOrGetNativeBridgeSecret:()=>(s.nativeBridgeSecret||(s.nativeBridgeSecret=Qe(E)),s.nativeBridgeSecret),nukeUserMetainfo:()=>{i().random={n:0},i().clockOffset=0,delete i().purchaseHistory,delete i().lastSessionId,delete i().appVersion},setClockOffset:T=>{let K;try{K={}.STAGE}catch{}if(K==="prod")throw new Error("setClockOffset() cannot be used in prod");i().clockOffset=Math.floor(T)},getClockOffset:g,getPushNotificationLastTargetedAt:u,getUserAssetUrl:T=>e.userAssetsBaseUrl()+T};return P}var Ho=e=>Es(re(I({},e),{isAsync:!1})),Vo=e=>{let t=Es(re(I({},e),{isAsync:!0}));return delete t.meta,t},Bo=class{constructor(e){this.receivedProfiles={},this.results=[];let t=(i,s)=>{for(let a in i)if(typeof i[a]=="function")i[a]=(...o)=>{let h=this.results[this.apiState.resultIndex];if(this.apiState.resultIndex++,this.apiState.apiCallQueue.push(s+a),!h)throw new F("Client action trying to execute more api calls than server. Client queue: "+this.apiState.apiCallQueue.join(", ")+". Server results array: "+JSON.stringify(this.results),"replication_error","async_action_api_error");if(h.failed){if(h.async)return Promise.reject(wi(h.value));throw wi(h.value)}else{if(s+a==="api.fetchStates"&&(this.receivedProfiles=I(I({},this.receivedProfiles),h.value)),s==="api.postMessage."&&e.onMessagePosted(o[0]),s==="api.abTests."&&(a==="assign"||a==="unassign")&&e.abTestsApiAccess()[a](e.apiMetaInfo(),e.id(),...o),s.startsWith("api.sharedStates")&&a==="setUserState"){let u=e.userSharedStates(),[,,p]=s.split("."),[g,f]=o,y={createdAt:0,rev:0,version:0,state:f,stateId:g,stateName:p,updatedAt:0,userId:e.id()};u[p]=re(I({},u[p]),{[g]:y})}return h.async?Promise.resolve(h.value):h.value}};else if(typeof i[a]=="object")t(i[a],s+a+".");else throw new Error("Unsupported field in API: "+a)};this.apiState={resultIndex:0,apiCallQueue:[]};let r=Vo({id:e.id,sessionId:e.sessionId,apiMetainfo:e.apiMetaInfo,userSharedStates:e.userSharedStates,chatbotMetainfo:e.chatbotMetainfo(),invokeTime:e.invokeTime,messages:e.messages(),scheduledActions:e.scheduledActions(),computedProperties:e.computedProperties(),asyncGetters:e.asyncGetters(),sharedStates:e.sharedStates(),onMessagePosted:()=>null,userAssetsBaseUrl:e.userAssetsBaseUrl,abTestsApiAccess:e.abTestsApiAccess});t(r,"api."),this.api=r}getAPI(e){return this.receivedProfiles={},this.apiState.apiCallQueue=[],this.apiState.resultIndex=0,this.results=e,this.api}getReceivedProfiles(){return this.receivedProfiles}getAPIState(){return this.apiState}},Go=class{constructor(e){this.postedMessages=[],this.invokeTime=0,this.api=Ho({id:e.id,sessionId:e.sessionId,apiMetainfo:()=>this.tempMetaInfo=this.tempMetaInfo||ee(e.apiMetaInfo()),userSharedStates:()=>this.tempSharedStates=this.tempSharedStates||ee(e.userSharedStates()),chatbotMetainfo:e.chatbotMetainfo(),invokeTime:()=>this.invokeTime,messages:e.messages(),scheduledActions:e.scheduledActions(),sharedStates:e.sharedStates(),onMessagePosted:(...t)=>this.postedMessages.push(t),userAssetsBaseUrl:e.userAssetsBaseUrl,abTestsApiAccess:e.abTestsApiAccess})}getAPI(e){var t;return this.postedMessages=[],this.tempMetaInfo=void 0,this.tempSharedStates=void 0,(t=this.api.meta)!=null&&t.hasUsedDateNow&&(this.api.meta.hasUsedDateNow=!1),this.invokeTime=e,this.api}updateMetaInfo(e){if(this.tempMetaInfo)for(let t in e)e[t]=this.tempMetaInfo[t]}updateUserSharedStates(e){for(let t in this.tempSharedStates)e[t]=this.tempSharedStates[t]}getPostedMessages(){return this.postedMessages}getInvokeTime(){return this.invokeTime}};function _r(){let e,t,r=(i,s)=>{i?t(i):e(s)};return{promise:new Promise((i,s)=>{t=s,e=i}),callback:r}}async function Pr(e){if(e!==0)return new Promise(t=>setTimeout(t,e))}async function Ii(e,t){if(t.linearBackoff&&t.exponentialBackoff)throw new Error("Cannot set linearBackoff and exponentialBackoff at the same time");let r=t.retries,i=(t==null?void 0:t.linearBackoff)||0,s=0;do try{return await e()}catch(a){if((t==null?void 0:t.retryOnlyIf)&&!t.retryOnlyIf(a)||s>=r)throw a;s++,t!=null&&t.exponentialBackoff?await Pr(Math.pow(2,s)*t.exponentialBackoff+(Math.random()*t.exponentialBackoff-t.exponentialBackoff)):await Pr(s*i)}while(1);throw new Error("Unreachable")}var Ti=e=>typeof window>"u"?Buffer.from(e,"base64").toString("binary"):window.atob(e),Cr=(e,t)=>typeof window>"u"?global.setTimeout(e,t).unref():window.setTimeout(e,t),Wo=class{constructor(e){this.opts=e,this.actionInvocationCallbacks={},this.queue=[],this.replicationBatch={queue:[],batchId:Qe(),requestedProfileIds:[],clientRandomSeed:-1},this.replicationFlushPromise=null,this.batchToRetry=null,this.lockPromise=null,this.flushTimer=null,this.heartbeatTimer=0,this.isPaused=!1,this.isOnline=!0,this.onMessagesReceivedHandlers=[],this.consistentFetchTimestamps={},this.onMessagePosted=(r,i)=>{this.replicationBatch.requestedProfileIds.includes(r)||this.replicationBatch.requestedProfileIds.push(r),this.consistentFetchTimestamps[r]=i.timestamp,this.opts.hooks.onMessagePosted(r,i)},this.currentState=e.userData.state;let t=_t(e.id,e.userData);Ae(this.currentState,t,e.config),this.externalState=ee(this.currentState),Ae(this.externalState,t,e.config),this.apiMetainfo=e.userData.metainfo,this.chatbotMetainfo=e.userData.chatbotMetainfo,this.metainfoMVCC=e.userData.metainfoMVCC,this.revId=e.userData.rev,this.syncApiCache=new Go({id:()=>this.opts.id,sessionId:()=>this.opts.sessionId,apiMetaInfo:()=>this.apiMetainfo,userSharedStates:()=>e.userData.userSharedStates,chatbotMetainfo:()=>this.chatbotMetainfo,messages:()=>this.opts.config.messages,scheduledActions:()=>this.opts.config.scheduledActions,sharedStates:()=>this.opts.config.sharedStates,ruleset:()=>this.opts.config.ruleset,userAssetsBaseUrl:()=>this.opts.userAssetsBaseUrl,abTestsApiAccess:()=>this.opts.abTestsManager.clientActionsApi}),this.asyncApiCache=new Bo({id:()=>this.opts.id,sessionId:()=>this.opts.sessionId,apiMetaInfo:()=>this.apiMetainfo,userSharedStates:()=>e.userData.userSharedStates,chatbotMetainfo:()=>this.chatbotMetainfo,invokeTime:()=>this.opts.now(),messages:()=>this.opts.config.messages,scheduledActions:()=>this.opts.config.scheduledActions,computedProperties:()=>this.opts.config.computedProperties,asyncGetters:()=>this.opts.config.asyncGetters,sharedStates:()=>this.opts.config.sharedStates,ruleset:()=>this.opts.config.ruleset,onMessagePosted:r=>{this.consistentFetchTimestamps[r]=this.opts.now()},userAssetsBaseUrl:()=>this.opts.userAssetsBaseUrl,abTestsApiAccess:()=>this.opts.abTestsManager.clientActionsApi}),this.resetHeartbeatTimer()}async enqueueAction(e,t,r){let{promise:i,callback:s}=_r();this.queue.push({type:t,fnName:e,args:r,callback:(o,h)=>{o!==void 0&&(this.actionInvocationCallbacks.cancelled&&o==="cancelled"?this.actionInvocationCallbacks.cancelled(e,r):this.actionInvocationCallbacks.failed&&this.actionInvocationCallbacks.failed(e,r,o.message||o)),s(o,h)},promise:i}),this.resolveQueue();let a=await i;return await this.lockPromise,a}resetQueue(){this.queue.forEach(e=>e.callback("cancelled")),this.queue=[],this.replicationBatch={queue:[],batchId:Qe(),requestedProfileIds:[],clientRandomSeed:-1},this.batchToRetry&&(this.batchToRetry.queue.forEach(e=>e.callback("cancelled",void 0)),this.batchToRetry=null,this.lockPromise=null)}onRefresh(e){this.currentState=e.state,Ae(this.currentState,_t(this.opts.id,e),this.opts.config),this.apiMetainfo=e.metainfo,this.revId=e.rev,this.isOnline=!0,this.resetHeartbeatTimer(),this.onStateChanged()}async retryLastRequest(){if(this.batchToRetry){if(this.flushReplication(),await this.replicationFlushPromise,!this.isOnline)throw new Error("Retrying last request failed.");return!0}else return!1}async waitForEmptyQueue(){if(!(this.queue.length===0&&!this.lockPromise))return this.lockPromise?await this.lockPromise:await Pr(0),this.waitForEmptyQueue()}async flush(e){let t=e&&e.skipErrorHandlers;this.flushReplication();let r=new Promise((i,s)=>{this.replicationFlushPromise?this.replicationFlushPromise.then(()=>{this.replicationBatch.queue.length>0||!!this.replicationFlushPromise?this.flush(e).then(()=>i()):this.lockPromise?this.lockPromise.then(()=>this.flush(e).then(()=>i())):i()}).catch(a=>{t?i():(this.handleError(a),s(a))}):i()});return t?new Promise(i=>{this.waitForEmptyQueue().then(()=>i(r)).catch(s=>i(r))}):this.waitForEmptyQueue().then(()=>r)}async checkForMessages(){if(!this.replicationFlushPromise)if(this.replicationBatch.queue.length>0)this.flushReplication();else{tt.debug("Sending heartbeat");let{promise:e,callback:t}=_r();this.queue.push({type:"sync",fnName:br,args:[],callback:t,promise:e}),this.resolveQueue(),e.catch(r=>{})}await this.replicationFlushPromise,await this.lockPromise}getPurchaseHistory(){return ks(this.apiMetainfo)}getExternalState(){return this.externalState}pause(){this.isPaused=!0,this.clearHeartbeatTimer(),this.isOnline&&this.flush()}resume(){this.isPaused=!1,this.resetHeartbeatTimer()}onMessagesReceived(e){this.onMessagesReceivedHandlers.push(e)}removeMessagesReceivedHandler(e){let t=this.onMessagesReceivedHandlers.indexOf(e);t>=0&&this.onMessagesReceivedHandlers.splice(t,1)}calcConsistentFetchIds(){var r;let e=((r=this.opts.replicantOptions.devOpts)==null?void 0:r.maxRecentMessagesTime)||Ao,t=this.dateNow()-e;return Object.keys(this.consistentFetchTimestamps).filter(i=>this.consistentFetchTimestamps[i]>t)}invokeAsyncAction(e,t,r){let i=this.opts.config.actions[e.fnName];if(i.type!=="async")throw new Error("Inconsistent async / sync function invocation.");this.actionInvocationCallbacks.preInvoke&&this.actionInvocationCallbacks.preInvoke(e.fnName,e.args);let s=i.fn(t,e.args,r);return this.actionInvocationCallbacks.postInvoke&&this.actionInvocationCallbacks.postInvoke(e.fnName,e.args),s}invokeSyncAction(e,t,r){let i=this.opts.config.actions[e.fnName];if(i.type!=="sync")throw new Error("Inconsistent async / sync function invocation.");this.actionInvocationCallbacks.preInvoke&&this.actionInvocationCallbacks.preInvoke(e.fnName,e.args);let s=i.fn(t,e.args,r);return this.actionInvocationCallbacks.postInvoke&&this.actionInvocationCallbacks.postInvoke(e.fnName,e.args),s}resolveQueue(){if(this.lockPromise){let r=this.lockPromise;r.then(()=>{this.lockPromise===r&&(this.lockPromise=null,this.resolveQueue())}).catch(i=>null);return}let e=!1,t=!1;for(;this.queue.length>0&&!this.lockPromise;){let r=this.queue.shift();if(r.fnName===br){this.replicationBatch.queue.push({fn:r.fnName,args:r.args,async:r.type==="async",callback:r.callback}),e=!0,t=!0;continue}if(r.type==="sync"){let i=r.fnName===bi,s=this.opts.config.actions[r.fnName];if(i){if(s)throw new Error("System action names should not be available.")}else if(!s||s.type!=="sync")throw new Error("Inconsistent async / sync function invocation.");this.apiMetainfo.clockOffset=this.apiMetainfo.clockOffset||0;let a=this.opts.now()-this.apiMetainfo.clockOffset,o=this.syncApiCache.getAPI(a),h;try{i?Ht({state:this.currentState,metainfo:o.meta.apiMetainfo(),updatedAt:this.currentState.updatedAt,fn:u=>{this.applyMessages(this.currentState,r.args)},userSharedStates:o.meta.userSharedStates(),config:this.opts.config}):h=Ht({state:this.currentState,metainfo:o.meta.apiMetainfo(),updatedAt:this.currentState.updatedAt,fn:u=>this.invokeSyncAction(r,this.currentState,o),userSharedStates:o.meta.userSharedStates(),config:this.opts.config})}catch(u){this.currentState=ki({oldState:this.currentState,newState:this.externalState,metainfo:this.apiMetainfo,userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config}),this.queue.forEach(p=>p.callback("cancelled")),this.queue=[],r.callback(u);return}if(this.syncApiCache.updateMetaInfo(this.apiMetainfo),this.syncApiCache.updateUserSharedStates(this.opts.userData.userSharedStates),this.syncApiCache.getPostedMessages().forEach(u=>this.onMessagePosted(...u)),this.replicationBatch.queue.push({fn:r.fnName,args:i?r.args.map(u=>u.id):r.args,async:!1,callback:r.callback,meta:o.meta.hasUsedDateNow?{now:this.syncApiCache.getInvokeTime()}:void 0}),e=!0,this.onStateChanged(),i)for(let u of this.onMessagesReceivedHandlers)u(r.args);r.callback(void 0,ee(h)),this.opts.hooks.onActionCompleted(this.replicationBatch.batchId)}else if(r.type==="async"){let{promise:i,callback:s}=_r();this.replicationBatch.queue.push({fn:r.fnName,args:r.args,async:!0,meta:{now:this.opts.now()},callback:s}),this.lockPromise=i.catch(a=>r.callback(a)).then(a=>{if(!a)return;let{result:o,batchId:h,requestedProfiles:u,serverUpdatedAt:p,messages:g}=a,f=this.asyncApiCache.getAPI(o),y=this.opts.config.actions[r.fnName];if(!y||y.type!=="async")return Promise.reject("Action "+r.fnName+" is not an action or is not async.");let b=Ht({state:this.currentState,metainfo:this.apiMetainfo,updatedAt:p,fn:P=>this.invokeAsyncAction(r,P,f),userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config}),E=P=>{if(g.length>0){Ht({state:this.currentState,metainfo:this.apiMetainfo,updatedAt:p,fn:T=>{this.applyMessages(T,g)},userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config});for(let T of this.onMessagesReceivedHandlers)T(g)}this.opts.hooks.onReplicationResultStates(I(I({},this.asyncApiCache.getReceivedProfiles()),u),h),this.crosscheckAsyncAPICalls(r.fnName,this.asyncApiCache.getAPIState(),o.length),this.onStateChanged(),r.callback(void 0,ee(P)),this.opts.hooks.onActionCompleted(this.replicationBatch.batchId)};if(typeof b<"u"&&typeof b.then=="function")return b.then(E).catch(P=>{r.callback(P),this.handleError(P)});E(b)}).catch(a=>{r.callback(a),this.handleError(a)}),e=!0,t=!0}else throw new Error("Action of type "+r.type+" should not be on the queue!")}e&&(!t&&!!this.opts.replicantOptions.batchingMaxTime?this.scheduleReplication():this.flushReplication(),this.resetHeartbeatTimer()),(this.queue.length>0||this.lockPromise)&&this.resolveQueue()}scheduleReplication(){this.flushTimer||(this.flushTimer=Cr(()=>this.flushReplication(),this.opts.replicantOptions.batchingMaxTime))}flushReplication(){if(this.replicationFlushPromise||(this.flushTimer&&(clearTimeout(this.flushTimer),this.flushTimer=null),this.replicationBatch.queue.length===0&&(!this.batchToRetry||this.batchToRetry.queue.length===0)))return;this.batchToRetry||(this.batchToRetry=this.replicationBatch,this.replicationBatch={queue:[],requestedProfileIds:[],batchId:Qe(),clientRandomSeed:-1});let e=this.batchToRetry,t=e.queue.slice(),r=e.queue[e.queue.length-1].async?t.pop():null;if(t.some(i=>i.async))throw new Error("Too many async actions in batch.");e.clientRandomSeed===-1&&(e.clientRandomSeed=this.apiMetainfo.random.n),this.replicationFlushPromise=this.postReplicationQueue(e).then(i=>{var a,o,h,u;if(this.batchToRetry=null,i.newLastUpdated){Ye({state:this.currentState,metainfo:this.apiMetainfo,updatedAt:i.newLastUpdated,userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config}),this.externalState=I({},this.externalState);let{id:p,createdAt:g,updatedAt:f}=this.currentState;Ae(this.externalState,{id:p,createdAt:g,updatedAt:f,userSharedStates:this.opts.userData.userSharedStates,metainfo:this.apiMetainfo},this.opts.config)}let s=r?1:0;if(s!==i.results.length)throw new Error("Invalid number of results received from server: "+i.results.length+(" expected: "+s));for(let p of t)p.callback(void 0,void 0);if(r==null||r.callback(void 0,{result:i.results.shift(),batchId:e.batchId,requestedProfiles:i.requestedProfiles,messages:i.messages,serverUpdatedAt:i.lastUpdated}),!r&&!this.lockPromise&&i.messages.length>0&&this.enqueueAction(bi,"sync",i.messages).catch(p=>this.handleError(new F(`Error applying messages on the client: ${p.message||p}`,"replication_error","message_errored","fatal"))),(a=i.metainfoDelta)!=null&&a.hasPhoneNumber&&(this.apiMetainfo.hasPhoneNumber=i.metainfoDelta.hasPhoneNumber),(o=i.metainfoDelta)!=null&&o.paymentSubscriptionStatus&&(this.metainfoMVCC.paymentSubscription=(h=i.metainfoDelta)==null?void 0:h.paymentSubscriptionStatus),(u=i.metainfoDelta)==null?void 0:u.purchaseHistory){let p=this.apiMetainfo.purchaseHistory||[];this.apiMetainfo.purchaseHistory=p.concat(i.metainfoDelta.purchaseHistory)}r||this.opts.hooks.onReplicationResultStates(i.requestedProfiles||{},e.batchId),this.replicationFlushPromise=null,this.isOnline=!0,this.flushReplication()}).catch(i=>{if(this.replicationFlushPromise=null,i.code!==et.network_error){this.batchToRetry=null;for(let s of e.queue)s.callback(i,void 0);this.resetQueue()}this.handleError(i)})}applyMessages(e,t){let r=this.opts.config.messages;if(r)for(let i of t)!r[i.name]||r[i.name].schema.validate(i.args)||r[i.name].reducer(e,i.args,{senderId:i.sender,timestamp:i.timestamp})}handleError(e){this.isOnline=!1,this.clearHeartbeatTimer(),this.opts.hooks.onError(e)}async postReplicationQueue(e){let{queue:t,requestedProfileIds:r,clientRandomSeed:i}=e,s={queue:t.map(u=>({fn:u.fn,async:u.async,args:u.args,meta:u.meta})),rev:this.revId,requestedProfileIds:r,consistentFetchIds:this.calcConsistentFetchIds(),sid:this.opts.sessionId,clientRandomSeed:i,crqid:Qe()},a=this.dateNow(),o=await this.opts.httpClient.doPostReplicationRequest(s),h=this.dateNow();if(h-a<ys){let u=jr(a,h,o);this.opts.adjustClockOffset(u)}if(!o.data||!o.data.results||typeof o.data.rev!="number")throw new Error("Invalid replication response.");return this.revId=o.data.rev,{results:o.data.results,messages:o.data.messages,metainfoDelta:o.data.metainfoDelta,requestedProfiles:o.data.requestedProfiles,lastUpdated:o.data.lastUpdated,newLastUpdated:o.data.newLastUpdated}}resetHeartbeatTimer(){this.clearHeartbeatTimer();let e=this.opts.replicantOptions.checkForMessagesInterval;!e||!this.isOnline||this.isPaused||(this.heartbeatTimer=Cr(()=>this.scheduleCheckForMessages(),e))}clearHeartbeatTimer(){this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=0)}scheduleCheckForMessages(){if(this.replicationFlushPromise||this.queue.length>0||this.replicationBatch.queue.length>0||this.batchToRetry){this.resetHeartbeatTimer();return}this.queue.push({type:"sync",fnName:br,args:[],callback:()=>null}),this.resolveQueue()}onStateChanged(){this.externalState=ki({oldState:this.externalState,newState:this.currentState,metainfo:this.apiMetainfo,userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config}),this.opts.hooks.onStateChanged(this.externalState)}dateNow(){var e,t;return((t=(e=this.opts.replicantOptions.devOpts)==null?void 0:e.dateNow)==null?void 0:t.call(e))||Date.now()}crosscheckAsyncAPICalls(e,t,r){if(t.resultIndex!==r)throw new F(`Action ${e} used ${t.resultIndex} api calls: `+t.apiCallQueue.join(", ")+`; but server provided ${r} results!`,"replication_error","async_action_api_error")}};function ki(e){let t=Jt(e.oldState,e.newState);if(t!==e.oldState){let{id:r,createdAt:i,updatedAt:s}=e.newState;Ae(t,{id:r,createdAt:i,updatedAt:s,metainfo:e.metainfo,userSharedStates:e.userSharedStates},e.config)}return t}function Ye(e){Ae(e.state,{createdAt:e.state.createdAt,id:e.state.id,updatedAt:e.updatedAt,metainfo:e.metainfo,userSharedStates:e.userSharedStates},e.config)}function Ht(e){let t=e.state.updatedAt;Ye({state:e.state,metainfo:e.metainfo,updatedAt:e.updatedAt,userSharedStates:e.userSharedStates,config:e.config});try{let r=e.fn(e.state);return r&&typeof r.then=="function"?r.then(i=>(Ye({state:e.state,metainfo:e.metainfo,updatedAt:t,userSharedStates:e.userSharedStates,config:e.config}),i)).catch(i=>(Ye({state:e.state,metainfo:e.metainfo,updatedAt:t,userSharedStates:e.userSharedStates,config:e.config}),Promise.reject(i))):(Ye({state:e.state,metainfo:e.metainfo,updatedAt:t,userSharedStates:e.userSharedStates,config:e.config}),r)}catch(r){throw Ye({state:e.state,metainfo:e.metainfo,updatedAt:t,userSharedStates:e.userSharedStates,config:e.config}),r}}var Ko=class{constructor(e,t){this.httpClient=e,this.now=t,this.calledUpdateSelf=!1}async updateSelf(e,t){this.calledUpdateSelf=!0,await this.httpClient.doPostSocialGraphUpdateSelf({nonPlayerFriendIds:e,meta:t})}async trackInteractions(e){if(!this.calledUpdateSelf)throw Error("socialGraph.updateSelf must be called before tracking interactions");let t=this.now(),r=e.map(i=>re(I({},i),{timestamp:i.timestamp||t}));await this.httpClient.doPostSocialGraphTrackInteractions({interactions:r})}};function zo(e){if(e.indexOf("data:")!==0)throw new Ei("Invalid dataUrl");let t=e.substring(e.indexOf(":")+1,e.indexOf(","));if(t!=="image/jpeg;base64"&&t!=="image/png;base64")throw new Ei("Unsupported media type: "+t);return t}var Ei=class extends Error{constructor(e){super(e),this.name="APIError"}},Yo=class{constructor(e){this.httpClient=e}async upload(e){if(e.length>94e4)throw new F("Maximum payload size exceeded for dataUrl: "+e.length,"replication_error","user_asset_upload_error");zo(e);let t=await this.httpClient.doUploadUserAssetRequest({dataUrl:e},{defaultErrorCodes:{code:"replication_error",subCode:"user_asset_upload_error"}});if(!t.data||!t.data.assetUrl)throw new F("Invalid user asset upload response.","replication_error","user_asset_upload_error");return t.data.assetUrl}},Jo=class{constructor(e,t,r,i,s,a,o,h,u,p,g,f,y){this.id=e,this.sessionId=t,this.userData=r,this.config=i,this.options=s,this.httpClient=a,this.kvStore=o,this.internalKvStore=h,this.replicantVersion=u,this.userAssetsBaseUrl=p,this.chatbotAssetUrls=g,this.extraData=f,this.asyncGetters={},this.invoke={},this.extras={getECPM:()=>({fb:this.extraData.ecpmPerAdPlacement?{perAdPlacement:this.extraData.ecpmPerAdPlacement}:{}}),afterContextSwitch:async b=>{await this.httpClient.doPostAfterContextSwitchRequest({contextSwitchEventId:b.contextSwitchEventId})}},this.paymentSubscriptions={getStatus:()=>{var b;return(b=this.userData.metainfoMVCC.paymentSubscription)==null?void 0:b.status}},this.refreshToRetry=!1,this.forbidInvocations=!1,this.onStateChangedHandlers=[],this.paused=!1,this.onError=b=>{throw new Error(`{message: ${b.message}, code: ${b.code} }`)},this.onMessagePosted=(b,E)=>{this.friendsMngr.handleReplicantMessage(b,E)},this.handleActionCompleted=b=>{this.friendsMngr.handleReplicantActionCompleted(b),this.abTestsManager.handleReplicantActionCompleted()};for(let b in i.actions)this.invoke[b]=this.wrapAction(b,i.actions[b].type);for(let b in i.asyncGetters)this.asyncGetters[b]=E=>{let P=this.queueManager.calcConsistentFetchIds();return this.httpClient.doAsyncGetterRequest({args:E,name:b,sid:this.sessionId,consistentFetchIds:P})};this.clockSyncOffset=this.options.clockOffset||0,this.currentTime=this.userData.lastInvokeTime||0,this.friendsMngr=new Fo({config:i,options:s,httpClient:this.httpClient,adjustClockOffset:(...b)=>this.adjustClockOffset(...b),calcConsistentFetchIds:()=>this.queueManager.calcConsistentFetchIds()}),this.abTestsManager=new Do({config:i,metainfo:this.userData.metainfo,changeEvents:y}),r.chatbotMetainfo=r.chatbotMetainfo||{},this.otp=new qo({hasPhoneNumber:()=>!!this.userData.metainfo.hasPhoneNumber,httpClient:this.httpClient}),this.queueManager=new Wo({id:e,sessionId:this.sessionId,userData:r,config:i,replicantOptions:s,httpClient:this.httpClient,now:()=>this.now(),adjustClockOffset:(...b)=>this.adjustClockOffset(...b),hooks:{onStateChanged:b=>this.handleOnStateChanged(b),onActionCompleted:b=>this.handleActionCompleted(b),onMessagePosted:(b,E)=>this.onMessagePosted(b,E),onReplicationResultStates:(b,E)=>{this.friendsMngr.handleReplicationResultStates(b,E)},onError:b=>{b.code!==et.network_error&&(this.friendsMngr.clearLocks(),this.pause(),this.forbidInvocations=!0),this.onError(b)}},userAssetsBaseUrl:p,abTestsManager:this.abTestsManager}),this.socialGraph=new Ko(this.httpClient,()=>this.now()),this.userAssets=new Yo(this.httpClient),i.onError&&this.setOnError(i.onError)}get state(){return this.queueManager.getExternalState()}get userId(){return this.id}get friends(){return this.friendsMngr}get abTests(){return this.abTestsManager}getChatbotSessionData(){return{sessionId:this.sessionId,appVersion:this.config.version}}onStateChanged(e){this.onStateChangedHandlers.push(e)}removeStateChangedHandler(e){this.onStateChangedHandlers=this.onStateChangedHandlers.filter(t=>t!==e)}clearStateChangedHandlers(){this.onStateChangedHandlers=[]}onMessagesReceived(e){this.queueManager.onMessagesReceived(e)}removeMessagesReceivedHandler(e){this.queueManager.removeMessagesReceivedHandler(e)}setOnError(e){this.onError=e}pause(){this.paused=!0,this.queueManager.pause(),this.friendsMngr.pause(),this.httpClient.pause()}resume(e){this.forbidInvocations||(this.paused=!1,this.queueManager.resume(),this.friendsMngr.resume(),this.httpClient.resume(),e!=null&&e.skipCheckForMessages||this.checkForMessages())}isPaused(){return this.paused}async fetchStates(e){return this.friendsMngr.fetchOtherPlayerStates(e)}async waitForEmptyQueue(){return this.queueManager.waitForEmptyQueue()}async flush(e){return this.queueManager.flush(e)}now(){return this.currentTime=Math.max(this.currentTime,Math.floor(this.dateNow()+this.clockSyncOffset)),this.currentTime+(this.userData.metainfo.clockOffset||0)}adjustClockOffset(e){var r;let t=((r=this.options.devOpts)==null?void 0:r.clockSyncOffsetAllowedDifference)||Io/2;Math.abs(this.now()-(this.dateNow()+e))>t&&(this.clockSyncOffset=e)}checkForMessages(){return this.forbidInvocations?Promise.reject(new F("Do not check for messages while out of sync. Refresh first!","replication_error","invoking_while_out_of_sync")):this.queueManager.checkForMessages()}async setTestUsers(e){return(await this.httpClient.doPostTestUsers({states:e})).data.testUsersMap}getPurchaseHistory(){return this.queueManager.getPurchaseHistory()}getToken(){return this.httpClient.getToken()}async inferGenderFromName(e){return(await this.httpClient.doPostInferGenderFromName({name:e})).data}async refresh(e){this.friendsMngr.clearLocks(),this.queueManager.resetQueue(),await this.flush({skipErrorHandlers:!0}),e&&this.httpClient.setSignature(e);let t;try{t=await Ts({httpClient:this.httpClient,devOpts:this.options.devOpts,sessionId:this.sessionId,skipOnLoginAction:!0,isWebPlayable:ws(this.userId)})}catch(r){throw this.refreshToRetry=!0,this.onError(r),r}this.forbidInvocations=!1,this.refreshToRetry=!1,this.clockSyncOffset=t.clockOffset,this.currentTime=t.data.lastInvokeTime||0,this.queueManager.onRefresh(t.data),this.resume({skipCheckForMessages:!0})}async retryLastRequest(){let e;return this.refreshToRetry?(await this.refresh(),e=!0):e=await this.queueManager.retryLastRequest(),this.friendsMngr.goOnline(),e}async uploadUserAsset(e){return this.userAssets.upload(e)}async sendIOSPushNotification(e){return(await this.httpClient.doPostAPN(e)).data}getAppleDeviceToken(){var e,t;return(e=this.userData.chatbotMetainfo)!=null&&e.appleDeviceTokenUpdatedAt&&_s(this.userData.chatbotMetainfo.appleDeviceTokenUpdatedAt,this.dateNow())||(t=this.userData.chatbotMetainfo)==null?void 0:t.appleDeviceToken}async sendAndroidPushNotification(e){return(await this.httpClient.doPostAndroidPushNotification(e)).data}getAndroidDeviceToken(){var e,t;return(e=this.userData.chatbotMetainfo)!=null&&e.androidDeviceTokenUpdatedAt&&Ss(this.userData.chatbotMetainfo.androidDeviceTokenUpdatedAt,this.dateNow())||(t=this.userData.chatbotMetainfo)==null?void 0:t.androidDeviceToken}async sendPushNotification(e){let s=e,{notification:t}=s,r=jt(s,["notification"]),i;if("text"in t){let{text:{title:a,body:o}}=t;i={ios:{alert:{title:a,body:o},sound:"default"},android:{title:a,body:o,icon:"ic_launcher",sound:"default"}}}else i=t.overrideDefaultProps;return(await this.httpClient.doPostPushNotification(I({notifications:i},r))).data}getNativeBridgeSecret(){var e;return(e=this.userData.chatbotMetainfo)==null?void 0:e.nativeBridgeSecret}getGeolocation(){return this.extraData.geolocation}getReplicantVersion(){return this.replicantVersion}getExchangeRatesUSD(){return I({},this.extraData.exchangeRatesUSD)}getUserAssetUrl(e){return this.userAssetsBaseUrl+e}getChatbotAssetUrl(e){return this.chatbotAssetUrls[e]}setActionPreInvokeCallback(e){this.queueManager.actionInvocationCallbacks.preInvoke=e}setActionPostInvokeCallback(e){this.queueManager.actionInvocationCallbacks.postInvoke=e}setActionCancelledCallback(e){this.queueManager.actionInvocationCallbacks.cancelled=e}setActionFailedCallback(e){this.queueManager.actionInvocationCallbacks.failed=e}handleOnStateChanged(e){this.onStateChangedHandlers.forEach(t=>t(e))}wrapAction(e,t){return r=>{let i=!1;try{i={}.STAGE==="prod"}catch{}return!i&&r!==void 0&&!So(r)&&(tt.warn([`Action ${e} was called with an argument that can't be sent to the server.`,"Argument: "+Co(r,4),"Would be sent as: "+JSON.stringify(r,null,4)].join(`
`)),tt.warn("Above Warning may become an EXCEPTION in future release, please fix it!")),this.forbidInvocations?Promise.reject(new F(`Trying to invoke ${e} while state is out of sync. Refresh first!`,"replication_error","invoking_while_out_of_sync")):this.queueManager.enqueueAction(e,t,r)}}dateNow(){var e,t;return((t=(e=this.options.devOpts)==null?void 0:e.dateNow)==null?void 0:t.call(e))||Date.now()}},Qo=c.union([c.string(),c.unknown()]).customValidator(e=>e!==null&&typeof e!="string"?"Not a string or null: "+e:null),Sr=c.object({$channel:c.string(),feature:c.string(),$subFeature:Qo}).additionalProperties(),w={AFTER_CONTEXT_SWITCH:"afterContextSwitch",REPLICATE:"replicate",LOGIN_OR_CREATE:"loginOrCreate",LOGIN_OR_CREATE_WEB_PLAYER:"loginOrCreateWebPlayer",TOKEN:"token",TOKEN_WEB_PLAYER:"tokenWebPlayer",FETCH_STATES:"fetchStates",ASYNC_GETTER:"asyncGetter",FB_WEBHOOK:"fbwebhook",UPLOAD_USER_ASSET:"userAsset",KEY_VALUE:"kv",INTERNAL_KEY_VALUE:"ikv",IOS_POST_APN:"iosPostApn",ANDROID_POST_PUSH_NOTIFICATION:"androidPushFcm",PUSH_NOTIFICATION:"pushNotification",FB_MESSAGING_REFERRALS:"fbmessaging_referrals",USER_DATA_DELETE:"deletion",LINE_WEBHOOK:"line-webhook",INFER_GENDER_FROM_NAME:"inferGenderFromName",OTP_INITIATE_ADD_RECEIVER:"otpInitiateAddReceiver",OTP_INITIATE_LOGIN:"otpInitiateLogin",SOCIAL_GRAPH_UPDATE_SELF:"socialGraphUpdateSelf",SOCIAL_GRAPH_TRACK_INTERACTIONS:"socialGraphTrackInteractions",STRIPE_WEBHOOK:"stripe_webhook"},Oi=c.object({alert:c.union([c.string(),c.object({title:c.string(),subtitle:c.string().optional(),body:c.string(),"launch-image":c.string().optional()})]),badge:c.number().optional(),sound:c.string().optional()}),Pi=c.object({title:c.string(),icon:c.string(),color:c.string().optional(),body:c.string().optional(),sound:c.string().optional()}),Xo={_healthcheck:Xe(null),[w.AFTER_CONTEXT_SWITCH]:Y(c.object({id:c.string(),auth:c.string(),contextSwitchEventId:c.string()})),[w.LOGIN_OR_CREATE]:Y(c.object({id:c.string(),auth:c.string().optional(),onLoginActionArgs:c.unknown(),prefetchKeys:c.array(c.string()).optional(),prefetchInternalKeys:c.array(c.string()).optional(),sid:c.string(),skipOnLoginAction:c.boolean().optional()})),[w.LOGIN_OR_CREATE_WEB_PLAYER]:Y(c.object({clientAppName:c.string().optional(),id:c.string().optional(),auth:c.string().optional(),onLoginActionArgs:c.unknown(),otp:c.object({code:c.string(),verificationId:c.string()}).optional(),prefetchKeys:c.array(c.string()).optional(),prefetchInternalKeys:c.array(c.string()).optional(),sid:c.string(),skipOnLoginAction:c.boolean().optional()})),[w.REPLICATE]:Y(c.object({id:c.string(),auth:c.string().optional(),queue:c.array(c.object({fn:c.string(),args:c.unknown().optional(),async:c.boolean(),meta:c.object({now:c.number()}).optional()}).customValidator(e=>e.async&&!e.meta?"Client time must be provided for async actions.":null)),rev:c.number(),clientRandomSeed:c.number(),requestedProfileIds:c.array(c.string()).optional(),consistentFetchIds:c.array(c.string()),sid:c.string(),crqid:c.string()})),[w.FETCH_STATES]:Y(c.object({id:c.string(),auth:c.string().optional(),ids:c.array(c.string()),consistentFetchIds:c.array(c.string()),friendRevs:c.map(c.number())})),[w.ASYNC_GETTER]:Y(c.object({id:c.string(),sid:c.string(),auth:c.string().optional(),name:c.string(),args:c.unknown(),consistentFetchIds:c.array(c.string())})),[w.FB_WEBHOOK]:pt({get:null,post:c.map(c.unknown())}),[w.USER_DATA_DELETE]:pt({get:c.object({id:c.string(),fbclid:c.string().optional()}),post:null}),[w.UPLOAD_USER_ASSET]:Y(c.object({id:c.string(),auth:c.string().optional(),dataUrl:c.string()})),[w.KEY_VALUE]:pt({post:c.object({id:c.string(),auth:c.string().optional(),pairs:c.map(c.string())}),get:c.object({id:c.string(),auth:c.string().optional(),keys:c.array(c.string())})}),[w.INTERNAL_KEY_VALUE]:pt({get:c.object({id:c.string(),auth:c.string().optional(),keys:c.array(c.string())}),post:null}),admin:Y(c.object({auth:c.string(),action:c.string(),args:c.unknown()})),"ios-bridge":pt({get:c.object({auth:c.string(),id:c.string(),uuid:c.string()}),post:c.object({auth:c.string(),id:c.string(),uuid:c.string(),payload:c.string()})}),[w.IOS_POST_APN]:Y(c.object({id:c.string(),auth:c.string().optional(),receiverId:c.string(),notification:Oi,payload:Sr,imageUrl:c.string().optional(),analyticsUserProps:c.map(c.unknown()).optional()})),[w.ANDROID_POST_PUSH_NOTIFICATION]:Y(c.object({id:c.string(),auth:c.string().optional(),receiverId:c.string(),notification:Pi,payload:Sr,imageUrl:c.string().optional(),analyticsUserProps:c.map(c.unknown()).optional()})),[w.PUSH_NOTIFICATION]:Y(c.object({id:c.string(),auth:c.string().optional(),receiverId:c.string(),notifications:c.object({ios:Oi,android:Pi}),payload:Sr,imageUrl:c.string().optional(),analyticsUserProps:c.map(c.unknown()).optional()})),[w.LINE_WEBHOOK]:Y(c.object({destination:c.string(),events:c.array(c.unknown())})),[w.TOKEN]:Xe(c.object({id:c.string(),auth:c.string().optional()})),[w.TOKEN_WEB_PLAYER]:Xe(c.object({id:c.string(),auth:c.string()})),[w.INFER_GENDER_FROM_NAME]:Y(c.object({id:c.string(),auth:c.string(),name:c.string()})),[w.OTP_INITIATE_ADD_RECEIVER]:Y(c.object({id:c.string(),auth:c.string(),consentText:c.string().customValidator(e=>e.length===0?"Value must be a non-empty string":null),receiver:c.string(),templateId:c.string().optional(),type:c.tuple(["sms"])})),[w.OTP_INITIATE_LOGIN]:Y(c.object({clientAppName:c.string().optional(),receiver:c.string(),templateId:c.string().optional(),type:c.tuple(["sms"])})),[w.SOCIAL_GRAPH_UPDATE_SELF]:Y(c.object({id:c.string(),auth:c.string(),nonPlayerFriendIds:c.array(c.string()),meta:c.map(c.unknown())})),[w.STRIPE_WEBHOOK]:Y(c.unknown()),[w.SOCIAL_GRAPH_TRACK_INTERACTIONS]:Y(c.object({id:c.string(),auth:c.string(),interactions:c.array(c.object({receiverId:c.string(),timestamp:c.int(),type:c.string(),meta:c.map(c.unknown())}))}))},Zo={nukeUser:Xe(c.object({id:c.string(),secret:c.tuple(["iamsure"])})),nukeDB:Xe(c.object({secret:c.tuple(["iamsupersure"])})),testUsers:Y(c.object({id:c.string(),auth:c.string().optional(),states:c.map(c.unknown())}))},Ci=I(I({},Zo),Xo);function Xe(e){return{get:{schema:e}}}function Y(e){return{post:{schema:e}}}function pt(e){return I(I({},Xe(e.get)),Y(e.post))}var el=class{constructor(e,t){this.type=e,this.getter=t}searchable(){if(this._payload)throw Error("Invalid computed property: use either .payload() or .searchable(), not both.");return this._searchable=!0,this._payload=!0,this}payload(){if(this._searchable)throw Error("Invalid computed property: use either .payload() or .searchable(), not both.");return this._payload=!0,this}};function xi(e,t){return new el(e,t)}var Ri={name:c.string(),picture:c.string(),friendIds:c.array(c.string())};function tl(e){return Os(e),e}function Os(e){var s,a;function t(o){throw new Error(o)}e||t("Replicant config not present. Make sure to make default export of the config module."),typeof e=="object"||t("Replicant config not an object."),"stateSchema"in e||t("No stateSchema in Replicant config"),typeof e.stateSchema=="object"||t("stateSchema is not an object."),e.stateSchema.__schema||t("stateSchema not a SchemaBuilder object"),"actions"in e||t("No actions in Replicant config. Keys: "+Object.keys(e)),"migrator"in e||t("No migrator in Replicant config"),"version"in e||t("Version missing in Replicant config"),"appName"in e||t("appName missing in Replicant config"),typeof e.appName=="string"||t("appName not a string in Replicant config"),typeof e.version=="string"||t("Version not a string in Replicant config: "+e.version);for(let o in e.stateSchema.getDefault())Uo.includes(o)&&t(`stateSchema.${o} is a reserved property - try using another name`);for(let o in e.actions)if(e.actions.hasOwnProperty(o)){o.startsWith("_")&&t("Actions names cannot start with _");let h=e.actions[o];"type"in h&&"fn"in h||t("Action "+o+" malformed. Please use helpers `actions` and `asyncAction`"),typeof h.type=="string"||t("Type flag in action["+o+"] not a string."),typeof h.fn=="function"||t("Function in actions["+o+"] not a function.")}if(typeof e.chatbot<"u"&&(typeof e.chatbot.events<"u"&&("onGameEnd"in e.chatbot.events&&(typeof e.chatbot.events.onGameEnd=="function"||t("chatbot.events.onGameEnd not a function: "+typeof e.chatbot.events.onGameEnd)),"onWebhook"in e.chatbot.events&&(typeof e.chatbot.events.onWebhook=="function"||t("chatbot.events.onWebhook not a function: "+typeof e.chatbot.events.onWebhook),Array.isArray(e.chatbot.events.enabledWebhookEvents)&&e.chatbot.events.enabledWebhookEvents.length>0||t("chatbot.events.enabledWebhookEvents must contain at least one item when the onWebhook handler is defined"))),"assets"in e.chatbot)){typeof e.chatbot.assets=="object"||t("chatbot.assets is not an object, use the renderTemplatesWithAssets helper to create this configuration.");let o=Object.values(e.chatbot.assets).flatMap(h=>typeof h=="string"?[h]:Object.values(h));for(let h of o)h.includes("\\")&&t("chatbot.assets contains invalid path separator: "+h)}if(typeof e.asyncGetters<"u"){typeof e.asyncGetters=="object"&&!Array.isArray(e.asyncGetters)||t("asyncGetters is not an object");for(let o in e.asyncGetters)typeof e.asyncGetters[o]=="function"||t(`asyncGetters.${o} is not a function`)}if(typeof e.onError<"u"&&(typeof e.onError=="function"||t("onError is not a function.")),e.onLoginAction&&!(e.onLoginAction in e.actions)&&t("onLoginAction is not a valid action"),typeof e.computedProperties<"u"){let o=e.computedProperties;for(let[h,u]of Object.entries(o)){if((h.includes(".")||h.includes(">"))&&t(`computed property name '${h}' contains illegal characters`),u.type.isObjectSchema()){Object.keys(u.type.getFullSchema()).length===0&&t("object schema must have at least one property");for(let p in u.type.getFullSchema()){let g=u.type.getFullSchema()[p];if(g.isArraySchema()){let f=g.getItemSchema();(f.isArraySchema()||f.isObjectSchema())&&t(`invalid nested object in computedProperties: ${h}.${p} array must only include primitive items`)}g.isObjectSchema()&&t(`invalid nested object in computedProperties: ${h}.${p} cannot be an object`)}}if(u.type.isArraySchema()){let p=u.type.getItemSchema();if(p.isObjectSchema())for(let g in p.getFullSchema()){let f=p.getFullSchema()[g];if(f.isArraySchema()){let y=f.getItemSchema();(y.isArraySchema()||y.isObjectSchema())&&t(`invalid nested object in computedProperties: ${h}[].${g} array must only include primitive items`)}f.isObjectSchema()&&t(`invalid nested object in computedProperties: ${h}[].${g} cannot be an object`)}}}}(((s=e.adminTool)==null?void 0:s.profile)||[]).forEach((o,h)=>{var p;typeof o=="object"||t(`adminTool.profile[${h}] is not an object`),typeof o.property=="string"||t(`adminTool.profile[${h}].property is not a string`);let u=(p=e.computedProperties)==null?void 0:p[o.property];if(u||t(`adminTool.profile[${h}].property is not found among computedProperties`),o.role){o.role in Ri||t(`adminTool.profile[${h}].role is not supported`);let g=Ri[o.role],f=JSON.stringify(g.serialize()),y=JSON.stringify(u.type.serialize());f===y||t(`adminTool.profile[${h}].property type does not match the role requirement.The role expects ${f}, but the computed property type is ${y}`)}});let r=[];if(e.messages)for(let o in e.messages)e.messages.hasOwnProperty(o)&&e.messages[o].isAdmin&&r.push(o);let i=((a=e.adminTool)==null?void 0:a.adminMessageGroups)||{};Object.keys(i).length&&!e.messages&&t("adminTool.adminMessageGroups contains grouped messages, while there's no messages provided in config.messages");for(let o in i){if(!i.hasOwnProperty(o))continue;let h=i[o];Array.isArray(h)||t(`adminTool.adminMessageGroups[${o}].messages is not an array`);for(let u of h)r.includes(u)||t(`adminTool.adminMessageGroups[${o}].messages contains message ${u}, which is not an admin message`)}if(e.otp&&e.otp.smsTemplates){typeof e.otp.smsTemplates!="object"&&t("otp.smsTemplates must be an object");for(let o in e.otp.smsTemplates){typeof e.otp.smsTemplates[o]!="function"&&t(`otp.smsTemplates.${o} must be a function of type (otpCode: string) => string`);let h="123456",u=e.otp.smsTemplates[o](h);(typeof u!="string"||!u.includes(h))&&t(`otp.smsTemplates.${o} must return a string that includes the OTP code argument`)}}e.ruleset&&$o.validate(e.ruleset),e.stateSchema.getDefault()}function rl(e,t){return{schema:e,reducer:t}}function il(e){return t=>t}function sl(e,t){return{schema:e,messages:t}}var nl=class{constructor(e,t={}){this.httpClient=e,this.cache=t}async get(e,t){return(await this.getBatch([e],t))[e]||null}async getBatch(e,t){let r=t&&t.forceFetch?e:e.filter(s=>!(s in this.cache));r.length&&await this.fetchBatch(r);let i={};for(let s of e)s in this.cache&&(i[s]=this.cache[s]);return i}async fetchBatch(e){let t=await this.httpClient.doGetInternalKeyValuePairsRequest({keys:e},{defaultErrorCodes:{code:"replication_error",subCode:"key_value_storage_error"},retryOptions:{retries:8}});if(!t.data)throw new F("Invalid internal key value store fetch response.","replication_error","key_value_storage_error");for(let r in t.data)this.cache[r]=t.data[r]}},al=class{constructor(e,t={}){this.httpClient=e,this.cache=t}async get(e,t){return(await this.getBatch([e],t))[e]||null}async getBatch(e,t){let r=t&&t.forceFetch?e:e.filter(s=>!(s in this.cache));r.length&&await this.fetchBatch(r);let i={};for(let s of e)s in this.cache&&(i[s]=this.cache[s]);return i}async send(e,t){return this.sendBatch({[e]:t})}async sendBatch(e){for(let r in e)if(!e[r]||typeof e[r]!="string")throw new F(`Invalid value for key: '${r}'.`,"replication_error","key_value_storage_error");let t={pairs:e};await this.httpClient.doSendKeyValuePairsRequest(t,{defaultErrorCodes:{code:"replication_error",subCode:"key_value_storage_error"},retryOptions:{retries:8}});for(let r in e)this.cache[r]=e[r]}async fetchBatch(e){let t=await this.httpClient.doGetKeyValuePairsRequest({keys:e},{defaultErrorCodes:{code:"replication_error",subCode:"key_value_storage_error"},retryOptions:{retries:8}});if(!t.data)throw new F("Invalid key value store fetch response.","replication_error","key_value_storage_error");for(let r in t.data)this.cache[r]=t.data[r]}},ol=class{constructor(e){this.options=e,this.signatureRefreshOffset=ue({hours:1}),e.initialSignature?this.setSignature(e.initialSignature):this.refreshSignature()}pause(){this.timeoutHandle&&(clearTimeout(this.timeoutHandle),delete this.timeoutHandle)}resume(){if(this.pause(),!this.options.obtainSignature)return;let e=this.getTimeUntilSignatureUpdate();e>0?this.timeoutHandle=Cr(()=>this.refreshSignature(),e):this.refreshSignature()}async getSignature(){return this.getTimeUntilSignatureUpdate()<=0&&(this.refreshSignature(),this.isSignatureExpired()&&await this.refreshSignaturePromise),this.signature}setSignature(e){if(this.signature=e,!!this.options.obtainSignature){this.pause();try{let t=e.split(".")[1],r=Ti(t),i=JSON.parse(r);if(i.exp)this.signatureExpiresAt=ue({seconds:i.exp}),this.signatureRefreshOffset=ue({minutes:1});else{let s=ue({seconds:i.issued_at});this.signatureExpiresAt=s+ue({hours:24})}}catch{this.signatureExpiresAt=this.options.now()+ue({hours:24})}this.resume()}}async getToken(){return this.isTokenExpired()&&this.refreshToken(),await this.refreshTokenPromise,this.token}setToken(e){this.token=e;try{let t=e.split(".")[1],r=Ti(t),i=JSON.parse(r);this.tokenExpiresAt=ue({seconds:i.exp})}catch(t){throw new F(t.message,"authorization_error","invalid_signature")}}refreshSignature(){let e=this.options.obtainSignature;!e||this.refreshSignaturePromise||(this.pause(),this.refreshSignaturePromise=e().then(t=>this.setSignature(t)).finally(()=>delete this.refreshSignaturePromise))}refreshToken(){return this.refreshTokenPromise||(this.refreshTokenPromise=this.options.obtainToken().then(e=>this.setToken(e)).finally(()=>delete this.refreshTokenPromise)),this.refreshTokenPromise}getTimeUntilSignatureUpdate(){return this.signatureExpiresAt===void 0?0:this.signatureExpiresAt-this.options.now()-this.signatureRefreshOffset}isSignatureExpired(){return this.getTimeUntilSignatureUpdate()<=this.signatureRefreshOffset}isTokenExpired(){if(this.tokenExpiresAt===void 0)return!0;let e=this.signatureRefreshOffset/2;return this.tokenExpiresAt-e<this.options.now()}},$i={Accept:"application/json, text/plain, */*","Content-Type":"text/plain"},ll=`Please check the following:
- Is the backend endpoint URL configured correctly? Make sure you're targeting the right deployment stage.`,cl=`Please check the following:
- Is the backend endpoint URL configured correctly?
- Is the backend infrastructure provisioned?
- Is the backend deployed?`,hl=`Please check the following:
- Is the backend endpoint URL configured correctly? Make sure you're targeting the right deployment stage.
- Is the current app version deployed to the backend?`,Ps=class{constructor(e){this.id=e.id,this.endpoint=e.endpoint,this.version=e.version,this.retryOptions=e.retryOptions,this.signatureManager=new ol({initialSignature:e.signature,obtainSignature:e.obtainSignature,obtainToken:()=>!this.id||ws(this.id)?this.doGetTokenWebPlayerRequest():this.doGetTokenRequest(),now:()=>e.now()}),this.fetchFn=e.fetchOverride||fetch.bind(window)}pause(){this.signatureManager.pause()}resume(){this.signatureManager.resume()}getToken(){return this.signatureManager.getToken()}async doLoginOrCreateRequest(e){let t=await this.postRequest(w.LOGIN_OR_CREATE,e);return this.signatureManager.setToken(t.data.token),t}async doLoginOrCreateWebPlayerRequest(e){let t=await this.postRequest(w.LOGIN_OR_CREATE_WEB_PLAYER,e);return this.id=t.data.id,this.signatureManager.setToken(t.data.token),this.signatureManager.setSignature(t.data.webPlayerAuthToken),t}async doFetchStatesRequest(e){return this.postRequest(w.FETCH_STATES,e)}async doAsyncGetterRequest(e){let{result:t}=await this.postRequest(w.ASYNC_GETTER,e);return t}async doPostAfterContextSwitchRequest(e,t){await this.postRequest(w.AFTER_CONTEXT_SWITCH,e,t)}async doPostReplicationRequest(e){return this.postRequest(w.REPLICATE,e)}async doSendKeyValuePairsRequest(e,t){return this.postRequest(w.KEY_VALUE,e,t)}async doGetKeyValuePairsRequest(e,t){return this.getRequest(w.KEY_VALUE,e,t)}doGetInternalKeyValuePairsRequest(e,t){return this.getRequest(w.INTERNAL_KEY_VALUE,e,t)}async doUploadUserAssetRequest(e,t){return this.postRequest(w.UPLOAD_USER_ASSET,e,t)}async doPostAPN(e,t){return this.postRequest(w.IOS_POST_APN,e,t)}async doPostAndroidPushNotification(e,t){return this.postRequest(w.ANDROID_POST_PUSH_NOTIFICATION,e,t)}async doPostPushNotification(e,t){return this.postRequest(w.PUSH_NOTIFICATION,e,t)}async doPostTestUsers(e,t){return this.postRequest("testUsers",e,t)}doPostInferGenderFromName(e,t){return this.postRequest(w.INFER_GENDER_FROM_NAME,e,t)}async doPostOtpInitiateAddReceiver(e,t){return(await this.postRequest(w.OTP_INITIATE_ADD_RECEIVER,e,t)).data}async doPostOtpInitiateLogin(e,t){return(await this.postRequest(w.OTP_INITIATE_LOGIN,e,t)).data}async doPostSocialGraphUpdateSelf(e,t){await this.postRequest(w.SOCIAL_GRAPH_UPDATE_SELF,e,t)}async doPostSocialGraphTrackInteractions(e,t){await this.postRequest(w.SOCIAL_GRAPH_TRACK_INTERACTIONS,e,t)}setSignature(e){this.signatureManager.setSignature(e)}async doGetTokenRequest(){return(await this.getRequest(w.TOKEN,{})).data.token}async doGetTokenWebPlayerRequest(){return(await this.getRequest(w.TOKEN_WEB_PLAYER,{})).data.token}async postRequest(e,t,r){var p;let i=e===w.LOGIN_OR_CREATE||e===w.LOGIN_OR_CREATE_WEB_PLAYER||e===w.OTP_INITIATE_LOGIN?await this.signatureManager.getSignature():await this.signatureManager.getToken(),s=!this.id&&(e===w.LOGIN_OR_CREATE_WEB_PLAYER||e===w.OTP_INITIATE_LOGIN)?t:re(I({},t),{id:this.id,auth:i});if((p=Ci[e].post.schema)!=null&&p.validate(s))throw new F("Invalid parameters","replication_error");let a=JSON.stringify(s);if(a.length>95e4)throw new F("Client payload too large","replication_error","payload_too_large");let o,h=this.endpoint+"/v"+this.version+"/"+e,u=I(I({},this.retryOptions),r==null?void 0:r.retryOptions);try{o=await Ii(()=>this.fetchFn(h,{method:"POST",headers:$i,body:a}),u)}catch(g){throw Ni({error:g,method:"POST",path:e,body:a})}return await this.parseTextAndHandleError(o,e,r==null?void 0:r.defaultErrorCodes)}async getRequest(e,t,r){var u;let i=e===w.TOKEN||e===w.TOKEN_WEB_PLAYER?await this.signatureManager.getSignature():await this.signatureManager.getToken(),s=this.endpoint+"/v"+this.version+"/"+e;if((u=Ci[e].get.schema)!=null&&u.validate(I({id:this.id,auth:i},t)))throw new F("Invalid parameters","replication_error");let a="?id="+encodeURIComponent(this.id)+(i?"&auth="+encodeURIComponent(i):"")+Object.keys(t).map(p=>"&"+p+"="+encodeURIComponent(JSON.stringify(t[p]))),o,h=I(I({},this.retryOptions),r==null?void 0:r.retryOptions);try{o=await Ii(()=>this.fetchFn(s+a,{method:"GET",headers:$i}),h)}catch(p){throw Ni({error:p,method:"GET",path:e+a})}return await this.parseTextAndHandleError(o,e,r==null?void 0:r.defaultErrorCodes)}async parseTextAndHandleError(e,t,r){let i=await e.text();if(e.status>=502)throw new F("Status code: "+e.status+", message: "+i,"server_error");if(e.status===403){let s;try{let a=JSON.parse(i);(a==null?void 0:a.subCode)in bs&&(s=a.subCode)}catch{}throw new F(((i||"")+`

`+ll).trim(),"authorization_error",s)}if(e.status>=400){let s=i,a=(r==null?void 0:r.code)||et.unknown_error,o=r==null?void 0:r.subCode;try{let h=JSON.parse(i);h.message&&(s=h.message),h.code in et&&(a=h.code),h.subCode in To&&(o=h.subCode)}catch{}throw e.status===404&&(s=((s||"")+`

`+hl).trim()),new F(s,a,o)}try{return JSON.parse(i)}catch{throw new F("Payload not JSON: "+i+" for API call: "+t,"unknown_error")}}};function Ni(e){let t=`${e.method} /${e.path}${e.body?" "+JSON.stringify(e.body):""}`;return new F(`${e.error.message||"Request failed"} (${t.length>500?t.substr(500)+"...":t})

${cl}`.trim(),"network_error")}async function ul(e){var k;let{config:t,id:r,isWebPlayable:i,options:s,internalKeyValueStorePrefetchKeys:a,keyValueStorePrefetchKeys:o}=e;if(Os(t),!r&&!i)throw new Error("Invalid ID");let h,u=()=>{var $,_;return(h==null?void 0:h.now())||((_=($=s.devOpts)==null?void 0:$.dateNow)==null?void 0:_.call($))||Date.now()},p=new Ps({id:r,endpoint:s.endpoint,version:t.version,fetchOverride:s.fetchOverride,signature:s.signature,retryOptions:((k=s.devOpts)==null?void 0:k.retryOptions)||{retries:1,linearBackoff:500},obtainSignature:s.obtainSignature,now:u}),g=Qe(),f=await Ts({clientAppName:e.clientAppName,httpClient:p,devOpts:s.devOpts,isWebPlayable:i,onLoginActionArgs:s.onLoginActionArgs,otp:i?e.otp:void 0,prefetchKeys:o,prefetchInternalKeys:a,sessionId:g}),y=f.clockOffset;s.clockOffset=y;try{f.data.state=t.stateSchema.tryDecode(f.data.state)}catch($){throw new Error("User state invalid: "+$.message)}let H=f.data,{extraData:b,replicantVersion:E,prefetchedKeys:P,prefetchedInternalKeys:T,userAssetsBaseUrl:K,chatbotAssetUrls:J,abTestChangeEvents:te}=H,ie=jt(H,["extraData","replicantVersion","prefetchedKeys","prefetchedInternalKeys","userAssetsBaseUrl","chatbotAssetUrls","abTestChangeEvents"]),S=new al(p,P),C=new nl(p,T);h=new Jo("id"in f.data?f.data.id:r,g,ie,t,s,p,S,C,E,K,J,b,te);let q="webPlayerAuthToken"in f.data?f.data.webPlayerAuthToken:void 0;return{replicant:h,webPlayerAuthToken:q}}async function dl(e){return new Ps({endpoint:e.endpoint,fetchOverride:e.fetchOverride,retryOptions:{retries:1,linearBackoff:500},version:e.version,now:()=>0,obtainSignature:void 0}).doPostOtpInitiateLogin({clientAppName:e.clientAppName,receiver:e.receiver,type:e.type,templateId:e.templateId})}var Lr=Zt(Xi()),pl="ReplicantWebCredentials_";function Fr(e,t){let r=_o(),i=t?`_${t}`:"",s=!r||r==="prod"?"":"-"+r;return pl+e+i+s}function Cs(e,t,r){let i=Fr(e,r),s=t.getItem(i);if(s)try{let a=JSON.parse(s);if(a.id&&typeof a.id=="string"&&a.token&&typeof a.token=="string")return a}catch(a){tt.error("Failed to parse web player credentials",a)}}function fl(e,t,r,i){let s=Fr(e,i);t.setItem(s,JSON.stringify(r))}function gl(e,t=Lr.localStorage,r){return!!Cs(e,t,r)}function ml(e,t=Lr.localStorage,r){let i=Fr(e,r);t.removeItem(i)}async function yl(e,t){let g=t,{kvStore:r,storageOverride:i,credentialsOverride:s}=g,a=jt(g,["kvStore","storageOverride","credentialsOverride"]);a.debug&&tt.level(he.debug),vo(a.platform);let o=i||Lr.localStorage,h=t.otp?void 0:s||Cs(e.appName,o,t.clientAppName),{replicant:u,webPlayerAuthToken:p}=await ul({clientAppName:t.clientAppName,config:e,id:h==null?void 0:h.id,options:re(I({},a),{obtainSignature:void 0,signature:h==null?void 0:h.token}),otp:t.otp,keyValueStorePrefetchKeys:r&&r.prefetchKeys,internalKeyValueStorePrefetchKeys:r==null?void 0:r.prefetchInternalKeys,isWebPlayable:!0});return(s||!h)&&p&&fl(e.appName,o,{id:u.userId,token:p},t.clientAppName),u}function Vt(e){return{fn:e,type:"sync"}}function Me(e){return{fn:e,type:"async"}}function bl(e,t){return r=>r}function vl(e,t){return r=>r}var _l=Zt(Xi());function Sl(e,t){let r=c.object({data:c.map(c.unknown()),profileData:c.unknown(),leaderboards:c.map(c.object({score:c.int(),recordData:c.unknown()}))}),i={leaderboards:xi(c.array(c.object({leaderboardId:c.string(),score:c.int(),recordData:c.string()})),g=>Object.entries(g.leaderboards).map(([f,y])=>{var b;return{leaderboardId:f,score:y.score,recordData:JSON.stringify((b=y.recordData)!=null?b:null)}})).searchable(),profileData:xi(c.string(),g=>{var f;return JSON.stringify((f=g.profileData)!=null?f:null)}).payload()},s={global:{schema:c.object({storage:c.map(c.unknown()),members:c.map(c.boolean())})}},a=il()({setGroupStorage:rl(c.object({props:c.map(c.unknown())}),(g,f,y)=>{g.global.members[y.senderId]=!0;for(let b in f.props){let E=f.props[b];g.global.storage[b]=E}})}),o={groups:sl(s,a)},h=vl()({getPaymentStatus:(g,f)=>f.payments.getPaymentStatus(g),fetchGroup:async(g,f)=>{let y=await f.sharedStates.groups.fetch(g.sharedStateId);return y?{members:Object.entries(y.global.members).filter(([b,E])=>E).map(([b])=>b),storage:y.global.storage}:null},listLeaderboardRecords:async(g,f)=>(await f.searchPlayers({where:[{leaderboards:{leaderboardId:{isAnyOf:[g.leaderboardId]}}}],sort:[{field:"leaderboards.score",order:g.lowerIsBetter?"asc":"desc"}],limit:50})).results.map((y,b)=>{let E=y.leaderboards.find(P=>P.leaderboardId===g.leaderboardId);if(!E)throw new Error(`Unexpected error. ${y.id} has no record for ${g.leaderboardId}`);return{rank:b+1,score:E.score,recordData:E.recordData,playerId:y.id,profileData:JSON.parse(y.profileData)}}),getLeaderboardRecords:async(g,f)=>(await f.searchPlayers({where:[{id:{isOneOf:g.playerIds},leaderboards:{leaderboardId:{isAnyOf:[g.leaderboardId]}}}],limit:100})).results.map(y=>{let b=y.leaderboards.find(E=>E.leaderboardId===g.leaderboardId);if(!b)throw new Error(`Unexpected error. ${y.id} has no record for ${g.leaderboardId}`);return{rank:-1,score:b.score,recordData:b.recordData,playerId:y.id,profileData:JSON.parse(y.profileData)}}),getLeaderboardRecordCount:async(g,f)=>await f.countPlayers({where:[{leaderboards:{leaderboardId:{isAnyOf:[g.leaderboardId]}}}]})}),u=bl()({asyncCreateInvoice:Me(async(g,f,y)=>{let{paymentIntent:b}=await y.payments.createInvoice(f);return{paymentIntent:b}}),asyncCancelSubscription:Me(async(g,f,y)=>{await y.paymentSubscriptions.cancel(f)}),asyncCompleteSubscription:Me(async(g,f,y)=>y.paymentSubscriptions.verify(f)),asyncInitiateSubscription:Me(async(g,f,y)=>{let{subscriptionId:b,paymentIntent:E,setupIntent:P}=await y.paymentSubscriptions.initiate(f),T=E||P;if(!T)throw Error("Did not receive either payment or setup intent");return{clientSecret:T,subscriptionId:b}}),setDataProperties:Vt((g,f)=>{g.data=I(I({},g.data),f)}),removeDataProperties:Vt((g,f)=>{for(let y of f)delete g.data[y]}),asyncVerifyOtp:Me((g,f,y)=>y.otp.verifyOtp(f)),asyncCreateGroup:Me(async(g,f,y)=>await y.sharedStates.groups.create()),setGroupStorage:Vt(async(g,f,y)=>{y.sharedStates.groups.postMessage.setGroupStorage(f.sharedStateId,{props:f.props})}),setLeaderboardProfileData:Vt((g,f)=>{g.profileData=f.profileData}),submitLeaderboardRecord:Me((g,f)=>{let y=g.leaderboards[f.leaderboardId];y?(f.lowerIsBetter&&f.score<=y.score||!f.lowerIsBetter&&f.score>=y.score)&&(y.score=f.score,y.recordData=f.recordData):g.leaderboards[f.leaderboardId]={score:f.score,recordData:f.recordData}})}),p={smsTemplates:{loginTemplateEn:g=>"Your one-time passcode is "+g}};return tl({actions:u,appName:e,asyncGetters:h,migrator:new Ka,otp:p,stateSchema:r,sharedStates:o,computedProperties:i,version:t,indexAnonymousWebPlayers:!0})}var Wt,Q,se,ne,ae,ge,we,xs=class{constructor(e,t){Ft(this,ne),Ft(this,ge),Ft(this,Q,void 0),Ft(this,se,void 0),this.purchases={initiatePurchase:async r=>{if(!L(this,Q).stripeAccountId)throw Error("stripeAccountId must be defined to initiate a purchase");let{paymentIntent:i}=await z(this,ne,ae).call(this).invoke.asyncCreateInvoice({productId:r,stripeAccountId:L(this,Q).stripeAccountId}),s=async()=>await z(this,ne,ae).call(this).asyncGetters.getPaymentStatus({paymentIntentId:i.id,stripeAccountId:L(this,Q).stripeAccountId})==="succeeded";return{clientSecret:i.clientSecret,verifyPayment:s}}},this.storage={get:()=>z(this,ne,ae).call(this).state.data,set:async r=>{await z(this,ne,ae).call(this).invoke.setDataProperties(r)},remove:async r=>{await z(this,ne,ae).call(this).invoke.removeDataProperties(r)},flush:async()=>{await z(this,ne,ae).call(this).flush()}},this.groups={create:async()=>(await z(this,ge,we).call(this)).invoke.asyncCreateGroup(),fetch:async r=>(await z(this,ge,we).call(this)).asyncGetters.fetchGroup({sharedStateId:r}),setStorage:async(r,i)=>{await(await z(this,ge,we).call(this)).invoke.setGroupStorage({sharedStateId:r,props:i})}},this.leaderboards={setProfileData:async r=>{await(await z(this,ge,we).call(this)).invoke.setLeaderboardProfileData(r)},getProfileData:()=>z(this,ne,ae).call(this).state.profileData,listRecords:async r=>(await z(this,ge,we).call(this)).asyncGetters.listLeaderboardRecords(r),getRecords:async r=>(await z(this,ge,we).call(this)).asyncGetters.getLeaderboardRecords(r),getRecordCount:async r=>(await z(this,ge,we).call(this)).asyncGetters.getLeaderboardRecordCount(r),submitRecord:async r=>(await z(this,ge,we).call(this)).invoke.submitLeaderboardRecord(r)},this.subscriptions={initiateSubscription:async r=>{let{clientSecret:i}=await z(this,ne,ae).call(this).invoke.asyncInitiateSubscription({productId:r,stripeAccountId:L(this,Q).stripeAccountId});return{clientSecret:i,completeSubscription:async()=>{await z(this,ne,ae).call(this).invoke.asyncCompleteSubscription({stripeAccountId:L(this,Q).stripeAccountId})}}},cancelSubscription:async()=>{await z(this,ne,ae).call(this).invoke.asyncCancelSubscription({stripeAccountId:L(this,Q).stripeAccountId})},getSubscription:()=>{let r=z(this,ne,ae).call(this).paymentSubscriptions.getStatus();return(r==null?void 0:r.productId)&&["active","trialing"].includes(r.status)?r.productId:null}},ze(this,Q,e),ze(this,se,t)}static async create(e){var i,s,a,o;let t=re(I({},e),{replicant:{appName:((i=e.replicant)==null?void 0:i.appName)||"replicant-lite",endpoint:((s=e.replicant)==null?void 0:s.endpoint)||"https://replicant-lite.us-east-1.replicant-playpass.gc-internal.net/replicant-lite",storageOverride:((a=e.replicant)==null?void 0:a.storageOverride)||_l.localStorage,version:((o=e.replicant)==null?void 0:o.version)||"1.1.0"}}),r=gl(t.replicant.appName,t.replicant.storageOverride,t.appName)?await Kt(t):void 0;return new xs(t,r)}getUserId(){var e;return(e=L(this,se))==null?void 0:e.userId}isLoggedIn(){var e;return!!((e=L(this,se))!=null&&e.otp.hasPhoneNumber())}async login(e){if(this.isLoggedIn())throw Error("Already logged in");if(L(this,se)){let{localePhoneNumber:t,phoneNumber:r,verificationId:i}=await L(this,se).otp.initiateOtp({consentText:e.consentText,receiver:e.phoneNumber,templateId:"loginTemplateEn",type:"sms"});return{localePhoneNumber:t,phoneNumber:r,verifyOtp:async s=>L(this,se).invoke.asyncVerifyOtp({code:s,verificationId:i})}}try{let{localePhoneNumber:t,phoneNumber:r,verificationId:i}=await dl({clientAppName:L(this,Q).appName,endpoint:L(this,Q).replicant.endpoint,receiver:e.phoneNumber,templateId:"loginTemplateEn",type:"sms",version:L(this,Q).replicant.version});return{localePhoneNumber:t,phoneNumber:r,verifyOtp:async s=>{try{return ze(this,se,await Kt(L(this,Q),{code:s,verificationId:i})),!0}catch(a){if(a.subCode!=="invalid_otp_code")throw a;return!1}}}}catch(t){if(t.subCode!=="invalid_otp_receiver")throw t;let r=await Kt(L(this,Q)),{localePhoneNumber:i,phoneNumber:s,verificationId:a}=await r.otp.initiateOtp({consentText:e.consentText,receiver:e.phoneNumber,templateId:"loginTemplateEn",type:"sms"});return{localePhoneNumber:i,phoneNumber:s,verifyOtp:async o=>await r.invoke.asyncVerifyOtp({code:o,verificationId:a})?(ze(this,se,r),!0):!1}}}logout(){z(this,ne,ae).call(this),ml(L(this,Q).replicant.appName,L(this,Q).replicant.storageOverride,L(this,Q).appName),ze(this,se,void 0),Wt=void 0}},wl=xs;Q=new WeakMap,se=new WeakMap,ne=new WeakSet,ae=function(){if(!this.isLoggedIn())throw Error("Cannot perform operation before logging in: resolve ReplicantLite.login and try again.");return L(this,se)},ge=new WeakSet,we=async function(){return L(this,se)||ze(this,se,await Kt(L(this,Q))),L(this,se)};function Kt(e,t){if(!Wt){let r=Sl(e.replicant.appName,e.replicant.version);Wt=yl(r,{clientAppName:e.appName,endpoint:e.replicant.endpoint,otp:t,platform:"tiktok",storageOverride:e.replicant.storageOverride})}return Wt}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const qr=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Hr=Symbol(),Mi=new Map;class Rs{constructor(t,r){if(this._$cssResult$=!0,r!==Hr)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){let t=Mi.get(this.cssText);return qr&&t===void 0&&(Mi.set(this.cssText,t=new CSSStyleSheet),t.replaceSync(this.cssText)),t}toString(){return this.cssText}}const Al=e=>new Rs(typeof e=="string"?e:e+"",Hr),rr=(e,...t)=>{const r=e.length===1?e[0]:t.reduce((i,s,a)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+e[a+1],e[0]);return new Rs(r,Hr)},Il=(e,t)=>{qr?e.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet):t.forEach(r=>{const i=document.createElement("style"),s=window.litNonce;s!==void 0&&i.setAttribute("nonce",s),i.textContent=r.cssText,e.appendChild(i)})},Di=qr?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let r="";for(const i of t.cssRules)r+=i.cssText;return Al(r)})(e):e;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var wr;const Ui=window.trustedTypes,Tl=Ui?Ui.emptyScript:"",ji=window.reactiveElementPolyfillSupport,xr={toAttribute(e,t){switch(t){case Boolean:e=e?Tl:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=e!==null;break;case Number:r=e===null?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch{r=null}}return r}},$s=(e,t)=>t!==e&&(t==t||e==e),Ar={attribute:!0,type:String,converter:xr,reflect:!1,hasChanged:$s};class Je extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(t){var r;(r=this.l)!==null&&r!==void 0||(this.l=[]),this.l.push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach((r,i)=>{const s=this._$Eh(i,r);s!==void 0&&(this._$Eu.set(s,i),t.push(s))}),t}static createProperty(t,r=Ar){if(r.state&&(r.attribute=!1),this.finalize(),this.elementProperties.set(t,r),!r.noAccessor&&!this.prototype.hasOwnProperty(t)){const i=typeof t=="symbol"?Symbol():"__"+t,s=this.getPropertyDescriptor(t,i,r);s!==void 0&&Object.defineProperty(this.prototype,t,s)}}static getPropertyDescriptor(t,r,i){return{get(){return this[r]},set(s){const a=this[t];this[r]=s,this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||Ar}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),this.elementProperties=new Map(t.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const r=this.properties,i=[...Object.getOwnPropertyNames(r),...Object.getOwnPropertySymbols(r)];for(const s of i)this.createProperty(s,r[s])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const r=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const s of i)r.unshift(Di(s))}else t!==void 0&&r.push(Di(t));return r}static _$Eh(t,r){const i=r.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}o(){var t;this._$Ep=new Promise(r=>this.enableUpdating=r),this._$AL=new Map,this._$Em(),this.requestUpdate(),(t=this.constructor.l)===null||t===void 0||t.forEach(r=>r(this))}addController(t){var r,i;((r=this._$Eg)!==null&&r!==void 0?r:this._$Eg=[]).push(t),this.renderRoot!==void 0&&this.isConnected&&((i=t.hostConnected)===null||i===void 0||i.call(t))}removeController(t){var r;(r=this._$Eg)===null||r===void 0||r.splice(this._$Eg.indexOf(t)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach((t,r)=>{this.hasOwnProperty(r)&&(this._$Et.set(r,this[r]),delete this[r])})}createRenderRoot(){var t;const r=(t=this.shadowRoot)!==null&&t!==void 0?t:this.attachShadow(this.constructor.shadowRootOptions);return Il(r,this.constructor.elementStyles),r}connectedCallback(){var t;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$Eg)===null||t===void 0||t.forEach(r=>{var i;return(i=r.hostConnected)===null||i===void 0?void 0:i.call(r)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$Eg)===null||t===void 0||t.forEach(r=>{var i;return(i=r.hostDisconnected)===null||i===void 0?void 0:i.call(r)})}attributeChangedCallback(t,r,i){this._$AK(t,i)}_$ES(t,r,i=Ar){var s,a;const o=this.constructor._$Eh(t,i);if(o!==void 0&&i.reflect===!0){const h=((a=(s=i.converter)===null||s===void 0?void 0:s.toAttribute)!==null&&a!==void 0?a:xr.toAttribute)(r,i.type);this._$Ei=t,h==null?this.removeAttribute(o):this.setAttribute(o,h),this._$Ei=null}}_$AK(t,r){var i,s,a;const o=this.constructor,h=o._$Eu.get(t);if(h!==void 0&&this._$Ei!==h){const u=o.getPropertyOptions(h),p=u.converter,g=(a=(s=(i=p)===null||i===void 0?void 0:i.fromAttribute)!==null&&s!==void 0?s:typeof p=="function"?p:null)!==null&&a!==void 0?a:xr.fromAttribute;this._$Ei=h,this[h]=g(r,u.type),this._$Ei=null}}requestUpdate(t,r,i){let s=!0;t!==void 0&&(((i=i||this.constructor.getPropertyOptions(t)).hasChanged||$s)(this[t],r)?(this._$AL.has(t)||this._$AL.set(t,r),i.reflect===!0&&this._$Ei!==t&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(t,i))):s=!1),!this.isUpdatePending&&s&&(this._$Ep=this._$E_())}async _$E_(){this.isUpdatePending=!0;try{await this._$Ep}catch(r){Promise.reject(r)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach((s,a)=>this[a]=s),this._$Et=void 0);let r=!1;const i=this._$AL;try{r=this.shouldUpdate(i),r?(this.willUpdate(i),(t=this._$Eg)===null||t===void 0||t.forEach(s=>{var a;return(a=s.hostUpdate)===null||a===void 0?void 0:a.call(s)}),this.update(i)):this._$EU()}catch(s){throw r=!1,this._$EU(),s}r&&this._$AE(i)}willUpdate(t){}_$AE(t){var r;(r=this._$Eg)===null||r===void 0||r.forEach(i=>{var s;return(s=i.hostUpdated)===null||s===void 0?void 0:s.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(t){return!0}update(t){this._$EC!==void 0&&(this._$EC.forEach((r,i)=>this._$ES(i,this[i],r)),this._$EC=void 0),this._$EU()}updated(t){}firstUpdated(t){}}Je.finalized=!0,Je.elementProperties=new Map,Je.elementStyles=[],Je.shadowRootOptions={mode:"open"},ji==null||ji({ReactiveElement:Je}),((wr=globalThis.reactiveElementVersions)!==null&&wr!==void 0?wr:globalThis.reactiveElementVersions=[]).push("1.3.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Ir;const rt=globalThis.trustedTypes,Li=rt?rt.createPolicy("lit-html",{createHTML:e=>e}):void 0,Oe=`lit$${(Math.random()+"").slice(9)}$`,Ns="?"+Oe,kl=`<${Ns}>`,it=document,St=(e="")=>it.createComment(e),wt=e=>e===null||typeof e!="object"&&typeof e!="function",Ms=Array.isArray,El=e=>{var t;return Ms(e)||typeof((t=e)===null||t===void 0?void 0:t[Symbol.iterator])=="function"},ft=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Fi=/-->/g,qi=/>/g,De=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,Hi=/'/g,Vi=/"/g,Ds=/^(?:script|style|textarea|title)$/i,Us=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),oe=Us(1),gt=Us(2),st=Symbol.for("lit-noChange"),X=Symbol.for("lit-nothing"),Bi=new WeakMap,Ol=(e,t,r)=>{var i,s;const a=(i=r==null?void 0:r.renderBefore)!==null&&i!==void 0?i:t;let o=a._$litPart$;if(o===void 0){const h=(s=r==null?void 0:r.renderBefore)!==null&&s!==void 0?s:null;a._$litPart$=o=new Tt(t.insertBefore(St(),h),h,void 0,r!=null?r:{})}return o._$AI(e),o},Ze=it.createTreeWalker(it,129,null,!1),Pl=(e,t)=>{const r=e.length-1,i=[];let s,a=t===2?"<svg>":"",o=ft;for(let u=0;u<r;u++){const p=e[u];let g,f,y=-1,b=0;for(;b<p.length&&(o.lastIndex=b,f=o.exec(p),f!==null);)b=o.lastIndex,o===ft?f[1]==="!--"?o=Fi:f[1]!==void 0?o=qi:f[2]!==void 0?(Ds.test(f[2])&&(s=RegExp("</"+f[2],"g")),o=De):f[3]!==void 0&&(o=De):o===De?f[0]===">"?(o=s!=null?s:ft,y=-1):f[1]===void 0?y=-2:(y=o.lastIndex-f[2].length,g=f[1],o=f[3]===void 0?De:f[3]==='"'?Vi:Hi):o===Vi||o===Hi?o=De:o===Fi||o===qi?o=ft:(o=De,s=void 0);const E=o===De&&e[u+1].startsWith("/>")?" ":"";a+=o===ft?p+kl:y>=0?(i.push(g),p.slice(0,y)+"$lit$"+p.slice(y)+Oe+E):p+Oe+(y===-2?(i.push(void 0),u):E)}const h=a+(e[r]||"<?>")+(t===2?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return[Li!==void 0?Li.createHTML(h):h,i]};class At{constructor({strings:t,_$litType$:r},i){let s;this.parts=[];let a=0,o=0;const h=t.length-1,u=this.parts,[p,g]=Pl(t,r);if(this.el=At.createElement(p,i),Ze.currentNode=this.el.content,r===2){const f=this.el.content,y=f.firstChild;y.remove(),f.append(...y.childNodes)}for(;(s=Ze.nextNode())!==null&&u.length<h;){if(s.nodeType===1){if(s.hasAttributes()){const f=[];for(const y of s.getAttributeNames())if(y.endsWith("$lit$")||y.startsWith(Oe)){const b=g[o++];if(f.push(y),b!==void 0){const E=s.getAttribute(b.toLowerCase()+"$lit$").split(Oe),P=/([.?@])?(.*)/.exec(b);u.push({type:1,index:a,name:P[2],strings:E,ctor:P[1]==="."?xl:P[1]==="?"?$l:P[1]==="@"?Nl:ir})}else u.push({type:6,index:a})}for(const y of f)s.removeAttribute(y)}if(Ds.test(s.tagName)){const f=s.textContent.split(Oe),y=f.length-1;if(y>0){s.textContent=rt?rt.emptyScript:"";for(let b=0;b<y;b++)s.append(f[b],St()),Ze.nextNode(),u.push({type:2,index:++a});s.append(f[y],St())}}}else if(s.nodeType===8)if(s.data===Ns)u.push({type:2,index:a});else{let f=-1;for(;(f=s.data.indexOf(Oe,f+1))!==-1;)u.push({type:7,index:a}),f+=Oe.length-1}a++}}static createElement(t,r){const i=it.createElement("template");return i.innerHTML=t,i}}function nt(e,t,r=e,i){var s,a,o,h;if(t===st)return t;let u=i!==void 0?(s=r._$Cl)===null||s===void 0?void 0:s[i]:r._$Cu;const p=wt(t)?void 0:t._$litDirective$;return(u==null?void 0:u.constructor)!==p&&((a=u==null?void 0:u._$AO)===null||a===void 0||a.call(u,!1),p===void 0?u=void 0:(u=new p(e),u._$AT(e,r,i)),i!==void 0?((o=(h=r)._$Cl)!==null&&o!==void 0?o:h._$Cl=[])[i]=u:r._$Cu=u),u!==void 0&&(t=nt(e,u._$AS(e,t.values),u,i)),t}class Cl{constructor(t,r){this.v=[],this._$AN=void 0,this._$AD=t,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(t){var r;const{el:{content:i},parts:s}=this._$AD,a=((r=t==null?void 0:t.creationScope)!==null&&r!==void 0?r:it).importNode(i,!0);Ze.currentNode=a;let o=Ze.nextNode(),h=0,u=0,p=s[0];for(;p!==void 0;){if(h===p.index){let g;p.type===2?g=new Tt(o,o.nextSibling,this,t):p.type===1?g=new p.ctor(o,p.name,p.strings,this,t):p.type===6&&(g=new Ml(o,this,t)),this.v.push(g),p=s[++u]}h!==(p==null?void 0:p.index)&&(o=Ze.nextNode(),h++)}return a}m(t){let r=0;for(const i of this.v)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,r),r+=i.strings.length-2):i._$AI(t[r])),r++}}class Tt{constructor(t,r,i,s){var a;this.type=2,this._$AH=X,this._$AN=void 0,this._$AA=t,this._$AB=r,this._$AM=i,this.options=s,this._$Cg=(a=s==null?void 0:s.isConnected)===null||a===void 0||a}get _$AU(){var t,r;return(r=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&r!==void 0?r:this._$Cg}get parentNode(){let t=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&t.nodeType===11&&(t=r.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,r=this){t=nt(this,t,r),wt(t)?t===X||t==null||t===""?(this._$AH!==X&&this._$AR(),this._$AH=X):t!==this._$AH&&t!==st&&this.$(t):t._$litType$!==void 0?this.T(t):t.nodeType!==void 0?this.k(t):El(t)?this.S(t):this.$(t)}M(t,r=this._$AB){return this._$AA.parentNode.insertBefore(t,r)}k(t){this._$AH!==t&&(this._$AR(),this._$AH=this.M(t))}$(t){this._$AH!==X&&wt(this._$AH)?this._$AA.nextSibling.data=t:this.k(it.createTextNode(t)),this._$AH=t}T(t){var r;const{values:i,_$litType$:s}=t,a=typeof s=="number"?this._$AC(t):(s.el===void 0&&(s.el=At.createElement(s.h,this.options)),s);if(((r=this._$AH)===null||r===void 0?void 0:r._$AD)===a)this._$AH.m(i);else{const o=new Cl(a,this),h=o.p(this.options);o.m(i),this.k(h),this._$AH=o}}_$AC(t){let r=Bi.get(t.strings);return r===void 0&&Bi.set(t.strings,r=new At(t)),r}S(t){Ms(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let i,s=0;for(const a of t)s===r.length?r.push(i=new Tt(this.M(St()),this.M(St()),this,this.options)):i=r[s],i._$AI(a),s++;s<r.length&&(this._$AR(i&&i._$AB.nextSibling,s),r.length=s)}_$AR(t=this._$AA.nextSibling,r){var i;for((i=this._$AP)===null||i===void 0||i.call(this,!1,!0,r);t&&t!==this._$AB;){const s=t.nextSibling;t.remove(),t=s}}setConnected(t){var r;this._$AM===void 0&&(this._$Cg=t,(r=this._$AP)===null||r===void 0||r.call(this,t))}}class ir{constructor(t,r,i,s,a){this.type=1,this._$AH=X,this._$AN=void 0,this.element=t,this.name=r,this._$AM=s,this.options=a,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=X}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,r=this,i,s){const a=this.strings;let o=!1;if(a===void 0)t=nt(this,t,r,0),o=!wt(t)||t!==this._$AH&&t!==st,o&&(this._$AH=t);else{const h=t;let u,p;for(t=a[0],u=0;u<a.length-1;u++)p=nt(this,h[i+u],r,u),p===st&&(p=this._$AH[u]),o||(o=!wt(p)||p!==this._$AH[u]),p===X?t=X:t!==X&&(t+=(p!=null?p:"")+a[u+1]),this._$AH[u]=p}o&&!s&&this.C(t)}C(t){t===X?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t!=null?t:"")}}class xl extends ir{constructor(){super(...arguments),this.type=3}C(t){this.element[this.name]=t===X?void 0:t}}const Rl=rt?rt.emptyScript:"";class $l extends ir{constructor(){super(...arguments),this.type=4}C(t){t&&t!==X?this.element.setAttribute(this.name,Rl):this.element.removeAttribute(this.name)}}class Nl extends ir{constructor(t,r,i,s,a){super(t,r,i,s,a),this.type=5}_$AI(t,r=this){var i;if((t=(i=nt(this,t,r,0))!==null&&i!==void 0?i:X)===st)return;const s=this._$AH,a=t===X&&s!==X||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,o=t!==X&&(s===X||a);a&&this.element.removeEventListener(this.name,this,s),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var r,i;typeof this._$AH=="function"?this._$AH.call((i=(r=this.options)===null||r===void 0?void 0:r.host)!==null&&i!==void 0?i:this.element,t):this._$AH.handleEvent(t)}}class Ml{constructor(t,r,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=r,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){nt(this,t)}}const Gi=window.litHtmlPolyfillSupport;Gi==null||Gi(At,Tt),((Ir=globalThis.litHtmlVersions)!==null&&Ir!==void 0?Ir:globalThis.litHtmlVersions=[]).push("2.2.3");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Tr,kr;class Le extends Je{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var t,r;const i=super.createRenderRoot();return(t=(r=this.renderOptions).renderBefore)!==null&&t!==void 0||(r.renderBefore=i.firstChild),i}update(t){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Dt=Ol(r,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Dt)===null||t===void 0||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Dt)===null||t===void 0||t.setConnected(!1)}render(){return st}}Le.finalized=!0,Le._$litElement$=!0,(Tr=globalThis.litElementHydrateSupport)===null||Tr===void 0||Tr.call(globalThis,{LitElement:Le});const Wi=globalThis.litElementPolyfillSupport;Wi==null||Wi({LitElement:Le});((kr=globalThis.litElementVersions)!==null&&kr!==void 0?kr:globalThis.litElementVersions=[]).push("3.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Vr=e=>t=>typeof t=="function"?((r,i)=>(window.customElements.define(r,i),i))(e,t):((r,i)=>{const{kind:s,elements:a}=i;return{kind:s,elements:a,finisher(o){window.customElements.define(r,o)}}})(e,t);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Dl=(e,t)=>t.kind==="method"&&t.descriptor&&!("value"in t.descriptor)?re(I({},t),{finisher(r){r.createProperty(t.key,e)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){typeof t.initializer=="function"&&(this[t.key]=t.initializer.call(this))},finisher(r){r.createProperty(t.key,e)}};function js(e){return(t,r)=>r!==void 0?((i,s,a)=>{s.constructor.createProperty(a,i)})(e,t,r):Dl(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Ce(e){return js(re(I({},e),{state:!0}))}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ul=({finisher:e,descriptor:t})=>(r,i)=>{var s;if(i===void 0){const a=(s=r.originalKey)!==null&&s!==void 0?s:r.key,o=t!=null?{kind:"method",placement:"prototype",key:a,descriptor:t(r.key)}:re(I({},r),{key:a});return e!=null&&(o.finisher=function(h){e(h,a)}),o}{const a=r.constructor;t!==void 0&&Object.defineProperty(r,i,t(i)),e==null||e(a,i)}};/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Er;const jl=((Er=window.HTMLSlotElement)===null||Er===void 0?void 0:Er.prototype.assignedElements)!=null?(e,t)=>e.assignedElements(t):(e,t)=>e.assignedNodes(t).filter(r=>r.nodeType===Node.ELEMENT_NODE);function Ll(e){const{slot:t,selector:r}=e!=null?e:{};return Ul({descriptor:i=>({get(){var s;const a="slot"+(t?`[name=${t}]`:":not([name])"),o=(s=this.renderRoot)===null||s===void 0?void 0:s.querySelector(a),h=o!=null?jl(o,e):[];return r?h.filter(u=>u.matches(r)):h},enumerable:!0,configurable:!0})})}var kt=globalThis&&globalThis.__decorate||function(e,t,r,i){var s=arguments.length,a=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(o=e[h])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a};let qe=class extends Le{constructor(){super(...arguments);this.loading=!1,this.subscribed=!1,this.abortOnClose=!0}onClose(t){t.preventDefault(),this.remove(),this.abortOnClose&&this.onAbort&&this.onAbort()}async onSubmit(t){t.preventDefault(),!this.loading&&(this.loading=!0,this.onPaymentSubmitted&&this.onPaymentSubmitted())}setErrorMessage(t){this.error=t}setLoading(t){this.loading=t}setSubscribed(){this.loading=!1,this.subscribed=!0}setAbortOnClose(t){this.abortOnClose=t}render(){let t;return this.subscribed?t=oe`
                <form id="payment-form" @submit="${this.onSubmit}">
                    <p>You have successfully subscribed!</p>
                    <br>
                </form>
            `:t=oe`
                <form id="payment-form" @submit="${this.onSubmit}">
                    <slot></slot>
                    <br>
                    <button id="submit" type="submit" ${this.loading?"disabled":""}>
                        ${this.loading?oe`<span class="spinner"></span>`:"Subscribe"}
                    </button>
                    <div id="error-message" class="error">
                        ${this.error}
                    </div>
                </form>
            `,oe`
            <div class="overlay">
                <div class="popup">
                    <div class="close" @click="${this.onClose}"></div>
                    ${t}
                </div>
            </div>
        `}};qe.styles=rr`
        :host {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 99999999;
            width: 100%;
            height: 100%;

            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Helvetica, sans-serif;
            user-select: none;

            color: #415462;

            --primary: #1095c1;
            font-size: 18px;
        }

        .overlay {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);

            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadein 0.05s linear;
        }

        @keyframes fadein {
            from {
                background: transparent;
            }
            to {
                background: rgba(0,0,0,0.6);
            }
        }

        .popup {
            position: relative;

            background: #fff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;

            box-shadow: rgba(0,0,0,0.3) 0 8px 24px;
            margin: 1rem;

            animation: popup-enter 0.2s ease-out;
        }

        @keyframes popup-enter {
            from {
                transform: translateY(-1.5rem);
            }
            to {
                transform: translateY(0);
            }
        }

        .spinner {
            display: inline-block;
            border-radius: 50%;

            width: 1em;
            height: 1em;
            padding: 0;
            margin: -8px 0;
            border: 5px solid rgba(0,0,0,0.1);
            border-bottom-color: #fff;
            animation: spinner-spin 1s infinite linear;
        }
        @keyframes spinner-spin { from { transform: rotate(0); } to { transform: rotate(360deg); } }

        .close {
            cursor: pointer;
            position: absolute;
            top: 0;
            right: 0;
            color: #c0c0c0;
            font-size: 32px;
            padding: 10px;
            line-height: 20px;
        }
        .close:after {
            content: "\\00d7";
        }
        .close:hover {
            color: #999;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        form * {
            padding: 0.5rem;
        }

        input {
            transition: box-shadow;
            outline: none;
            box-shadow: none;
            border: 1px solid #a2afb9;
            padding: 0.75rem 1rem;
            font-size: 1.25rem;
            border-radius: 0.25rem;
        }

        input:focus {
            box-shadow: 0 0 0 3px rgba(16, 149, 193, 0.125);
            border-color: var(--primary);
        }

        button {
            color: white;
            background: var(--primary);
            padding: 0.75rem 1rem;
            font-size: 1rem;

            border: none;
            outline: none;
            cursor: pointer;
            text-align: center;
            border-radius: 0.25rem;
            font-size: 1.25rem;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }

        #code {
            text-align: center;
        }
        .error {
            color: red;
        }
    `;kt([Ce()],qe.prototype,"loading",void 0);kt([Ce()],qe.prototype,"subscribed",void 0);kt([Ce()],qe.prototype,"abortOnClose",void 0);kt([Ce()],qe.prototype,"error",void 0);qe=kt([Vr("playpass-pay")],qe);async function Fl(){await at.subscriptions.getSubscription()}var lt=globalThis&&globalThis.__decorate||function(e,t,r,i){var s=arguments.length,a=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(o=e[h])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a};let Pe=class extends Le{constructor(){super(...arguments);this.loggedIn=!1,this.loading=!1}onClose(t){t.preventDefault(),this.remove(),this.loggedIn?this.onLogin&&this.onLogin():this.onAbort&&this.onAbort()}async onSubmitPhone(t){if(t.preventDefault(),this.loading)return;this.loading=!0;const r=window.intlTelInputGlobals.getInstance(this.phoneElement[0].children[0].children[1]).s.dialCode,i=this.phoneElement[0].children[0].children[1].value,s=i.startsWith("+")?i:r+i;this.error=void 0;try{const{verifyOtp:a}=await this.replicantClient.login({consentText:"Enter phone number",phoneNumber:s});this.verifyOtp=a}catch(a){console.error(a),this.error="Invalid phone number, try again",this.loading=!1;return}this.phone=i,this.loading=!1}async onInputCode(t){this.error=void 0;const r=t.target,i=/\d{6}/.exec(r.value);if(i){const s=i[0];await this.verifyOtp(s)?this.loggedIn=!0:this.error="Invalid code"}}onTryAnotherPhone(t){t.preventDefault(),this.error=void 0,this.phone=void 0}render(){let t;return this.loggedIn?t=oe`<h2>Welcome</h2>
                <p>Success! You are now logged in.</p>
                <form @submit="${this.onClose}">
                    <button type="submit">Continue</button>
                </form>`:this.phone?t=oe`<h2>Confirm</h2>
                <p>We sent a code to ${this.phone}, enter it below.</p>
                <form>
                    <input id="code" type="text" inputmode="numeric" pattern="[0-9]*" autocomplete="one-time-code" @input="${this.onInputCode}" autofocus />
                    <span class="error">${this.error}</span>
                    <a @click="${this.onTryAnotherPhone}" href="#">← Use a different phone number</a>
                </form>`:t=oe`<h2>Login</h2>
                <p>Enter your phone number below to login.</p>
                <form @submit="${this.onSubmitPhone}">
                    <slot></slot>
                    <span class="error">${this.error}</span>
                    <button type="submit" ${this.loading?"disabled":""}>
                        ${this.loading?oe`<span class="spinner"></span>`:"Send SMS"}
                    </button>
                </form>`,oe`
            <div class="overlay">
                <div class="popup">
                    <div class="close" @click="${this.onClose}"></div>
                    ${t}
                </div>
            </div>
        `}};Pe.styles=rr`
        :host {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            width: 100%;
            height: 100%;

            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Helvetica, sans-serif;
            user-select: none;

            color: #415462;

            --primary: #1095c1;
            font-size: 18px;
        }

        .overlay {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);

            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadein 0.05s linear;
        }

        @keyframes fadein {
            from {
                background: transparent;
            }
            to {
                background: rgba(0,0,0,0.6);
            }
        }

        .popup {
            position: relative;

            background: #fff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;

            box-shadow: rgba(0,0,0,0.3) 0 8px 24px;
            margin: 1rem;

            animation: popup-enter 0.2s ease-out;
        }

        @keyframes popup-enter {
            from {
                transform: translateY(-1.5rem);
            }
            to {
                transform: translateY(0);
            }
        }

        .spinner {
            display: inline-block;
            border-radius: 50%;

            width: 1em;
            height: 1em;
            padding: 0;
            margin: -8px 0;
            border: 5px solid rgba(0,0,0,0.1);
            border-bottom-color: #fff;
            animation: spinner-spin 1s infinite linear;
        }
        @keyframes spinner-spin { from { transform: rotate(0); } to { transform: rotate(360deg); } }

        .close {
            cursor: pointer;
            position: absolute;
            top: 0;
            right: 0;
            color: #c0c0c0;
            font-size: 32px;
            padding: 10px;
            line-height: 20px;
        }
        .close:after {
            content: "\\00d7";
        }
        .close:hover {
            color: #999;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        form * {
            padding: 0.5rem;
        }

        input {
            transition: box-shadow;
            outline: none;
            box-shadow: none;
            border: 1px solid #a2afb9;
            padding: 0.75rem 1rem;
            font-size: 1.25rem;
            border-radius: 0.25rem;
        }

        input:focus {
            box-shadow: 0 0 0 3px rgba(16, 149, 193, 0.125);
            border-color: var(--primary);
        }

        button {
            color: white;
            background: var(--primary);
            padding: 0.75rem 1rem;
            font-size: 1rem;

            border: none;
            outline: none;
            cursor: pointer;
            text-align: center;
            border-radius: 0.25rem;
            font-size: 1.25rem;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }

        #code {
            text-align: center;
        }
        .error {
            color: red;
        }
    `;lt([Ce()],Pe.prototype,"loggedIn",void 0);lt([Ce()],Pe.prototype,"phone",void 0);lt([Ce()],Pe.prototype,"error",void 0);lt([Ce()],Pe.prototype,"loading",void 0);lt([Ll({slot:""})],Pe.prototype,"phoneElement",void 0);Pe=lt([Vr("playpass-login")],Pe);let at,mt,Ke,yt,Br=!1;async function Ls(){await Promise.all([Qi.onLogin(at),Fl()]),Br=!0}function ql(){Br=!1}function Hl(){return Br}async function cc(){if(Hs("playpass.account.login"),Hl())return!0;if(yt)return yt;if(mt||(mt=document.createElement("link"),mt.rel="stylesheet",mt.href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css",document.head.appendChild(mt)),!Ke){Ke=document.createElement("script"),Ke.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"),Ke.setAttribute("crossorigin","anonymous"),document.head.appendChild(Ke);const s=document.createElement("style");s.innerText=".phoneInput { transition: box-shadow; outline: none; box-shadow: none; border: 1px solid #a2afb9; padding: 0.75rem 1rem; font-size: 1.25rem; border-radius: 0.25rem; } .phoneInput:focus { box-shadow: 0 0 0 3px rgba(16, 149, 193, 0.125); border-color: var(--primary); }",document.head.appendChild(s)}const e=document.createElement("div"),t=document.createElement("input");t.id="phone",t.className="phoneInput",t.type="tel",t.autocomplete="tel",t.required=!0,e.appendChild(t),window.intlTelInput?window.intlTelInput(t):Ke.onload=()=>{window.intlTelInput(t)};const r=document.createElement("playpass-login");r.appendChild(e),document.body.appendChild(r),yt=new Promise(s=>{r.replicantClient=at,r.onAbort=()=>{s(!1)},r.onLogin=async()=>{await Ls(),s(!0)}});const i=await yt;return yt=void 0,i}function hc(){Hs("playpass.account.logout"),at.logout(),ql()}async function Vl(e){const t="replicantCreds";let r=await je.get(t),i;function s(a){if(i&&i!=a)throw new Error("Multiple storage keys not supported");i=a}at=await wl.create({appName:e,replicant:{storageOverride:{length:1,getItem(a){return s(a),r},setItem(a,o){s(a),r=o,je.set(t,r)},removeItem(a){s(a),je.remove(t)},clear(){throw new Error("Not implemented")},key(){throw new Error("Not implemented")}},version:"1.4.1"},stripeAccountId:Bl()}),at.isLoggedIn()&&await Ls()}let vt="",Fs=!1,qs;async function uc(e){vt=await je.get("playerId"),vt||(vt=Yi("player"),je.set("playerId",vt)),qs=e==null?void 0:e.stripeAccount;const t=(e==null?void 0:e.gameId)||"unknown";await Promise.all([Ma(),Vl(t)]),Rr.init(t);const r=Nr(),i=Gl(),s=$a(location.href);s!=location.href&&history.replaceState(null,"",s),Rr.track("Entry",I(re(I({},i),{channel:r.channel,$referrer_id:r.referrer}),e==null?void 0:e.trackProps)),window.addEventListener("appinstalled",()=>{de.track("HomescreenInstall")}),Fs=!0}function Hs(e){if(!Fs)throw new Error(`Await for playpass.init() before calling ${e}()`)}function Bl(){return qs}function Vs(){return vt}function Gl(){const e=new URLSearchParams(location.search).get("payload");if(e)try{return JSON.parse(e)}catch{}return{}}const Wl=250;function Kl(e){const t="https://t.playpass.games/record",r=JSON.stringify(e);navigator.sendBeacon?navigator.sendBeacon(t,new Blob([r],{type:"application/json"})):fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:r})}class zl{constructor(){this.initialized=!1,this.gameId=void 0,this.eventQueue=[],this.userProps={},this.sessionId=Yi("session"),document.addEventListener("visibilitychange",()=>{document.visibilityState=="hidden"&&(this.track("PageHide"),this.flush())});const t=()=>{this.track("FirstTap"),window.removeEventListener("pointerdown",t)};window.addEventListener("pointerdown",t)}track(t,r){this.initialized&&this.eventQueue.length==0&&setTimeout(()=>{this.flush()},Wl),this.eventQueue.push({user_id:Vs(),session_id:this.sessionId,event_time:new Date().toISOString(),event_type:t,page:document.location.href,referrer:document.referrer,locale:navigator==null?void 0:navigator.language,event_properties:r||{},user_properties:this.userProps})}setUserProperties(t){this.userProps=I(I({},this.userProps),t)}init(t){this.initialized=!0,this.gameId=t,this.flush()}flush(){this.eventQueue.length&&(this.gameId&&Kl({project_id:this.gameId,events:this.eventQueue}),this.eventQueue.length=0)}}const Rr=new zl;class Yl{constructor(){this.targets=[Rr]}track(t,r){this.targets.forEach(i=>{i.track(t,r)})}setUserProperties(t){this.targets.forEach(r=>{r.setUserProperties(t)})}addTarget(t){this.targets.push(t)}}const Jl=new Yl,de=Jl;var Z;(function(e){e.Any="any",e.Facebook="facebook",e.Twitter="twitter",e.WhatsApp="whatsapp",e.Telegram="telegram",e.Clipboard="clipboard",e.Reddit="reddit"})(Z||(Z={}));/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*Ql(e,t){if(e!==void 0){let r=0;for(const i of e)yield t(i,r++)}}const Xl=rr`
    :host {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 0;
        width: 100%;
        height: 100%;

        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Helvetica, sans-serif;
        user-select: none;

        color: #415462;

        --primary: #1095c1;
        font-size: 18px;
    }

    .overlay {
        position: relative;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);

        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadein 0.05s linear;
    }

    @keyframes fadein {
        from {
            background: transparent;
        }
        to {
            background: rgba(0,0,0,0.6);
        }
    }

    .popup {
        position: relative;

        background: #fff;
        padding: 1.5rem;
        border-radius: 0.5rem;
        text-align: center;

        box-shadow: rgba(0,0,0,0.3) 0 8px 24px;
        margin: 1rem;

        animation: popup-enter 0.2s ease-out;
    }

    @keyframes popup-enter {
        from {
            transform: translateY(-1.5rem);
        }
        to {
            transform: translateY(0);
        }
    }

    .spinner {
        display: inline-block;
        border-radius: 50%;

        width: 1em;
        height: 1em;
        padding: 0;
        margin: -8px 0;
        border: 5px solid rgba(0,0,0,0.1);
        border-bottom-color: #fff;
        animation: spinner-spin 1s infinite linear;
    }
    @keyframes spinner-spin { from { transform: rotate(0); } to { transform: rotate(360deg); } }

    .close {
        cursor: pointer;
        position: absolute;
        top: 0;
        right: 0;
        color: #c0c0c0;
        font-size: 32px;
        padding: 10px;
        line-height: 20px;
    }
    .close:after {
        content: "\\00d7";
    }
    .close:hover {
        color: #999;
    }

    form {
        display: flex;
        flex-direction: column;
    }

    form * {
        padding: 0.5rem;
    }

    input {
        transition: box-shadow;
        outline: none;
        box-shadow: none;
        border: 1px solid #a2afb9;
        padding: 0.75rem 1rem;
        font-size: 1.25rem;
        border-radius: 0.25rem;
    }

    input:focus {
        box-shadow: 0 0 0 3px rgba(16, 149, 193, 0.125);
        border-color: var(--primary);
    }

    button {
        color: white;
        background: var(--primary);
        padding: 0.75rem 1rem;
        font-size: 1rem;

        border: none;
        outline: none;
        cursor: pointer;
        text-align: center;
        border-radius: 0.25rem;
        font-size: 1.25rem;
    }

    a {
        color: var(--primary);
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }

    .error {
        color: red;
    }
`;class Zl extends Le{onClose(t){t.preventDefault(),this.remove()}renderPopup(){return oe`<p>Hello world</p>`}render(){return oe`
            <div class="overlay">
                <div class="popup">
                    <div class="close" @click="${this.onClose}"></div>
                    ${this.renderPopup()}
                </div>
            </div>
        `}}var Bs=globalThis&&globalThis.__decorate||function(e,t,r,i){var s=arguments.length,a=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(o=e[h])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a};const ec=[{type:Z.Facebook,path:gt`<path d="M24 12a12 12 0 10-13.9 11.9v-8.4h-3V12h3V9.4c0-3 1.8-4.7 4.6-4.7l2.6.2v3h-1.5c-1.5 0-2 .9-2 1.8V12h3.4l-.5 3.5h-2.8v8.4A12 12 0 0024 12z" />`,color:"#0076FB"},{type:Z.Twitter,path:gt`<path d="M24 4.6a10 10 0 01-2.9.7 5 5 0 002.2-2.7c-1 .6-2 1-3.1 1.2a5 5 0 00-8.4 4.5A14 14 0 011.6 3.2 4.8 4.8 0 001 5.6a5 5 0 002.2 4.1 4.9 4.9 0 01-2.3-.6A5 5 0 005 14a5 5 0 01-2.2 0 5 5 0 004.6 3.5 9.9 9.9 0 01-6.1 2.1H0a14 14 0 007.6 2.2c9 0 14-7.5 14-14V7A10 10 0 0024 4.6z" />`,color:"#1DA1F2"},{type:Z.WhatsApp,path:gt`<path d="M17.5 14.4l-2-1c-.3 0-.5-.1-.7.2l-1 1.1c-.1.2-.3.3-.6.1s-1.3-.5-2.4-1.5a9 9 0 01-1.7-2c-.1-.3 0-.5.2-.6l.4-.6c.2-.1.2-.3.3-.5v-.5L9 7c-.2-.6-.4-.5-.6-.5h-.6c-.2 0-.5 0-.8.4-.2.3-1 1-1 2.5s1 2.8 1.2 3c.2.2 2.1 3.2 5.1 4.5l1.7.6a4 4 0 001.9.2c.5-.1 1.7-.8 2-1.5.2-.6.2-1.2.1-1.4l-.5-.3M12 21.8a9.9 9.9 0 01-5-1.4l-.4-.2-3.7 1 1-3.7-.2-.3a9.9 9.9 0 01-1.5-5.3 9.9 9.9 0 0116.8-7 9.8 9.8 0 013 7 9.9 9.9 0 01-10 9.9m8.4-18.3A11.8 11.8 0 0012.1 0 12 12 0 001.8 17.8L0 24l6.4-1.6a11.9 11.9 0 005.6 1.4 12 12 0 0012-11.9 11.8 11.8 0 00-3.5-8.4z" />`,color:"#25D366"},{type:Z.Telegram,path:gt`<path d="M23.91 3.79L20.3 20.84c-.25 1.21-.98 1.5-2 .94l-5.5-4.07-2.66 2.57c-.3.3-.55.56-1.1.56-.72 0-.6-.27-.84-.95L6.3 13.7.85 12c-1.18-.35-1.19-1.16.26-1.75l21.26-8.2c.97-.43 1.9.24 1.53 1.73z" />`,color:"#0088CC"},{type:Z.Clipboard,path:gt`<path d="M16 1H4a2 2 0 00-2 2v14h2V3h12V1zm3 4H8a2 2 0 00-2 2v14c0 1.1.9 2 2 2h11a2 2 0 002-2V7a2 2 0 00-2-2zm0 16H8V7h11v14z" />`,color:"#718096"}];let Qt=class extends Zl{constructor(){super(...arguments);this.shareText=""}onClose(t){super.onClose(t),this.onShare&&this.onShare(null)}onShareClick(t){if(this.onShare&&t.currentTarget instanceof HTMLButtonElement){const r=t.currentTarget.name;this.onShare(r)}this.remove()}renderPopup(){return oe`
            <p class="preview">
                ${this.shareText}
            </p>
            ${Ql(ec,t=>oe`
                <button style="background: ${t.color}" name="${t.type}" @click="${this.onShareClick}">
                    <svg fill="white" viewBox="0 0 24 24">
                        ${t.path}
                    </svg>
                </button>`)}
        `}};Qt.styles=[Xl,rr`
            button {
                font-size: 0;
                width: 4rem;
                padding: 0.5rem;
            }

            .preview {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 24rem;
                font-style: italic;
                color: #666;
            }
        `];Bs([js()],Qt.prototype,"shareText",void 0);Qt=Bs([Vr("playpass-share")],Qt);async function pc(e){var h,u;const t=(e==null?void 0:e.files)||[],r=(e==null?void 0:e.text)||t.length?e==null?void 0:e.text:zt(),i=(e==null?void 0:e.type)||Z.Any,s=I({fileCount:t.length,textLength:(h=r==null?void 0:r.length)!=null?h:0,type:i},e==null?void 0:e.trackProps);de.track("SharePrompted",s);const a={files:t,text:r};let o=!1;if(i==Z.Any)if(((u=navigator.canShare)==null?void 0:u.call(navigator,a))&&navigator.share&&"ontouchstart"in document.documentElement)try{await navigator.share(a),o=!0}catch(p){if(!(p instanceof Error))throw p;p.name=="AbortError"?de.track("ShareRejected",s):de.track("ShareError",re(I({},s),{error:p.name}))}else r&&(o=await new Promise(p=>{const g=document.createElement("playpass-share");g.shareText=r,g.onShare=f=>{p(f?Ki(f,r):!1)},document.body.appendChild(g)}));else r&&await Ki(i,r)&&(o=!0);return o&&de.track("ShareSent",s),o}async function Ki(e,t){const r=/\bhttps?:\/\/[^\s]+/,i=t.match(r),s=t.replace(r,"").trim();switch(e){case Z.Facebook:return bt("https://www.facebook.com/sharer/sharer.php",{quote:s,u:i?i[0]:zt()}),!0;case Z.Twitter:return bt("https://twitter.com/intent/tweet",{text:t}),!0;case Z.WhatsApp:return bt("https://api.whatsapp.com/send",{text:t}),!0;case Z.Telegram:return bt("https://telegram.me/share/msg",{text:s,url:i?i[0]:zt()}),!0;case Z.Reddit:return bt("https://www.reddit.com/submit",{title:s,url:i?i[0]:zt()}),!0;case Z.Clipboard:return ic(t),!0;default:throw new Error(`Unsupported share type: ${e}`)}}function bt(e,t){const r=new URL(e);for(const i in t)r.searchParams.set(i,t[i]);window.open(r.toString(),"_blank","noopener")}let tc={};function zt(e){var i,s;const t=location.port||location.hostname.endsWith(".playpass.games")?"playpass.link":location.hostname,r=Ra({channel:(i=e==null?void 0:e.channel)!=null?i:"SHARE",data:e==null?void 0:e.data,referrer:Vs(),gcinstant:re(I({},tc),{$channel:(s=e==null?void 0:e.channel)!=null?s:"SHARE"})});return rc(r),`https://${t}/${Ca(r)}`}async function rc(e){await(await fetch("https://api.playpass.link",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Basic d29yZHMuZ2c6RHV4ZXRTMVhPTXBEd3JjZA=="},body:JSON.stringify({url:e})})).json()}async function ic(e){try{de.track("ClipboardCopy"),await navigator.clipboard.writeText(e),de.track("ClipboardCopySuccess")}catch{const t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise((r,i)=>{document.execCommand("copy")?(de.track("ClipboardCopySuccess"),r()):(de.track("ClipboardCopyFailure"),i(new Error("execCommand copy failed"))),t.remove()})}}Z.Facebook,Z.Twitter,Z.Reddit;var Bt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},$r={exports:{}};(function(e,t){var r=200,i="Expected a function",s="__lodash_hash_undefined__",a=1,o=2,h=1/0,u=9007199254740991,p="[object Arguments]",g="[object Array]",f="[object Boolean]",y="[object Date]",b="[object Error]",E="[object Function]",P="[object GeneratorFunction]",T="[object Map]",K="[object Number]",J="[object Object]",te="[object Promise]",ie="[object RegExp]",S="[object Set]",C="[object String]",q="[object Symbol]",k="[object WeakMap]",H="[object ArrayBuffer]",$="[object DataView]",_="[object Float32Array]",D="[object Float64Array]",M="[object Int8Array]",O="[object Int16Array]",sr="[object Int32Array]",He="[object Uint8Array]",ct="[object Uint8ClampedArray]",nr="[object Uint16Array]",Gs="[object Uint32Array]",Ws=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ks=/^\w*$/,zs=/^\./,Ys=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Js=/[\\^$.*+?()[\]{}|]/g,Qs=/\\(\\)?/g,Xs=/^\[object .+?Constructor\]$/,Zs=/^(?:0|[1-9]\d*)$/,U={};U[_]=U[D]=U[M]=U[O]=U[sr]=U[He]=U[ct]=U[nr]=U[Gs]=!0,U[p]=U[g]=U[H]=U[f]=U[$]=U[y]=U[b]=U[E]=U[T]=U[K]=U[J]=U[ie]=U[S]=U[C]=U[k]=!1;var Gr=typeof Bt=="object"&&Bt&&Bt.Object===Object&&Bt,en=typeof self=="object"&&self&&self.Object===Object&&self,Te=Gr||en||Function("return this")(),Wr=t&&!t.nodeType&&t,Kr=Wr&&!0&&e&&!e.nodeType&&e,tn=Kr&&Kr.exports===Wr,zr=tn&&Gr.process,Yr=function(){try{return zr&&zr.binding("util")}catch{}}(),Jr=Yr&&Yr.isTypedArray;function rn(n,l){var d=n?n.length:0;return!!d&&on(n,l,0)>-1}function sn(n,l,d){for(var m=-1,A=n?n.length:0;++m<A;)if(d(l,n[m]))return!0;return!1}function nn(n,l){for(var d=-1,m=n?n.length:0;++d<m;)if(l(n[d],d,n))return!0;return!1}function an(n,l,d,m){for(var A=n.length,v=d+(m?1:-1);m?v--:++v<A;)if(l(n[v],v,n))return v;return-1}function on(n,l,d){if(l!==l)return an(n,ln,d);for(var m=d-1,A=n.length;++m<A;)if(n[m]===l)return m;return-1}function ln(n){return n!==n}function cn(n){return function(l){return l==null?void 0:l[n]}}function hn(n,l){for(var d=-1,m=Array(n);++d<n;)m[d]=l(d);return m}function un(n){return function(l){return n(l)}}function dn(n,l){return n.has(l)}function pn(n,l){return n==null?void 0:n[l]}function ar(n){var l=!1;if(n!=null&&typeof n.toString!="function")try{l=!!(n+"")}catch{}return l}function fn(n){var l=-1,d=Array(n.size);return n.forEach(function(m,A){d[++l]=[A,m]}),d}function gn(n,l){return function(d){return n(l(d))}}function or(n){var l=-1,d=Array(n.size);return n.forEach(function(m){d[++l]=m}),d}var mn=Array.prototype,yn=Function.prototype,Et=Object.prototype,lr=Te["__core-js_shared__"],Qr=function(){var n=/[^.]+$/.exec(lr&&lr.keys&&lr.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),Xr=yn.toString,ye=Et.hasOwnProperty,Ve=Et.toString,bn=RegExp("^"+Xr.call(ye).replace(Js,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zr=Te.Symbol,ei=Te.Uint8Array,vn=Et.propertyIsEnumerable,_n=mn.splice,Sn=gn(Object.keys,Object),cr=Ge(Te,"DataView"),ht=Ge(Te,"Map"),hr=Ge(Te,"Promise"),Be=Ge(Te,"Set"),ur=Ge(Te,"WeakMap"),ut=Ge(Object,"create"),wn=Re(cr),An=Re(ht),In=Re(hr),Tn=Re(Be),kn=Re(ur),Ot=Zr?Zr.prototype:void 0,dr=Ot?Ot.valueOf:void 0,ti=Ot?Ot.toString:void 0;function xe(n){var l=-1,d=n?n.length:0;for(this.clear();++l<d;){var m=n[l];this.set(m[0],m[1])}}function En(){this.__data__=ut?ut(null):{}}function On(n){return this.has(n)&&delete this.__data__[n]}function Pn(n){var l=this.__data__;if(ut){var d=l[n];return d===s?void 0:d}return ye.call(l,n)?l[n]:void 0}function Cn(n){var l=this.__data__;return ut?l[n]!==void 0:ye.call(l,n)}function xn(n,l){var d=this.__data__;return d[n]=ut&&l===void 0?s:l,this}xe.prototype.clear=En,xe.prototype.delete=On,xe.prototype.get=Pn,xe.prototype.has=Cn,xe.prototype.set=xn;function be(n){var l=-1,d=n?n.length:0;for(this.clear();++l<d;){var m=n[l];this.set(m[0],m[1])}}function Rn(){this.__data__=[]}function $n(n){var l=this.__data__,d=Pt(l,n);if(d<0)return!1;var m=l.length-1;return d==m?l.pop():_n.call(l,d,1),!0}function Nn(n){var l=this.__data__,d=Pt(l,n);return d<0?void 0:l[d][1]}function Mn(n){return Pt(this.__data__,n)>-1}function Dn(n,l){var d=this.__data__,m=Pt(d,n);return m<0?d.push([n,l]):d[m][1]=l,this}be.prototype.clear=Rn,be.prototype.delete=$n,be.prototype.get=Nn,be.prototype.has=Mn,be.prototype.set=Dn;function ve(n){var l=-1,d=n?n.length:0;for(this.clear();++l<d;){var m=n[l];this.set(m[0],m[1])}}function Un(){this.__data__={hash:new xe,map:new(ht||be),string:new xe}}function jn(n){return Ct(this,n).delete(n)}function Ln(n){return Ct(this,n).get(n)}function Fn(n){return Ct(this,n).has(n)}function qn(n,l){return Ct(this,n).set(n,l),this}ve.prototype.clear=Un,ve.prototype.delete=jn,ve.prototype.get=Ln,ve.prototype.has=Fn,ve.prototype.set=qn;function dt(n){var l=-1,d=n?n.length:0;for(this.__data__=new ve;++l<d;)this.add(n[l])}function Hn(n){return this.__data__.set(n,s),this}function Vn(n){return this.__data__.has(n)}dt.prototype.add=dt.prototype.push=Hn,dt.prototype.has=Vn;function _e(n){this.__data__=new be(n)}function Bn(){this.__data__=new be}function Gn(n){return this.__data__.delete(n)}function Wn(n){return this.__data__.get(n)}function Kn(n){return this.__data__.has(n)}function zn(n,l){var d=this.__data__;if(d instanceof be){var m=d.__data__;if(!ht||m.length<r-1)return m.push([n,l]),this;d=this.__data__=new ve(m)}return d.set(n,l),this}_e.prototype.clear=Bn,_e.prototype.delete=Gn,_e.prototype.get=Wn,_e.prototype.has=Kn,_e.prototype.set=zn;function Yn(n,l){var d=$e(n)||ci(n)?hn(n.length,String):[],m=d.length,A=!!m;for(var v in n)(l||ye.call(n,v))&&!(A&&(v=="length"||ni(v,m)))&&d.push(v);return d}function Pt(n,l){for(var d=n.length;d--;)if(li(n[d][0],l))return d;return-1}function ri(n,l){l=xt(l,n)?[l]:ii(l);for(var d=0,m=l.length;n!=null&&d<m;)n=n[Rt(l[d++])];return d&&d==m?n:void 0}function Jn(n){return Ve.call(n)}function Qn(n,l){return n!=null&&l in Object(n)}function pr(n,l,d,m,A){return n===l?!0:n==null||l==null||!$t(n)&&!Nt(l)?n!==n&&l!==l:Xn(n,l,pr,d,m,A)}function Xn(n,l,d,m,A,v){var x=$e(n),R=$e(l),N=g,V=g;x||(N=ke(n),N=N==p?J:N),R||(V=ke(l),V=V==p?J:V);var j=N==J&&!ar(n),B=V==J&&!ar(l),G=N==V;if(G&&!j)return v||(v=new _e),x||_a(n)?si(n,l,d,m,A,v):ha(n,l,N,d,m,A,v);if(!(A&o)){var le=j&&ye.call(n,"__wrapped__"),ce=B&&ye.call(l,"__wrapped__");if(le||ce){var Ee=le?n.value():n,Se=ce?l.value():l;return v||(v=new _e),d(Ee,Se,m,A,v)}}return G?(v||(v=new _e),ua(n,l,d,m,A,v)):!1}function Zn(n,l,d,m){var A=d.length,v=A,x=!m;if(n==null)return!v;for(n=Object(n);A--;){var R=d[A];if(x&&R[2]?R[1]!==n[R[0]]:!(R[0]in n))return!1}for(;++A<v;){R=d[A];var N=R[0],V=n[N],j=R[1];if(x&&R[2]){if(V===void 0&&!(N in n))return!1}else{var B=new _e;if(m)var G=m(V,j,N,n,l,B);if(!(G===void 0?pr(j,V,m,a|o,B):G))return!1}}return!0}function ea(n){if(!$t(n)||ga(n))return!1;var l=ui(n)||ar(n)?bn:Xs;return l.test(Re(n))}function ta(n){return Nt(n)&&gr(n.length)&&!!U[Ve.call(n)]}function ra(n){return typeof n=="function"?n:n==null?Ia:typeof n=="object"?$e(n)?na(n[0],n[1]):sa(n):ka(n)}function ia(n){if(!ma(n))return Sn(n);var l=[];for(var d in Object(n))ye.call(n,d)&&d!="constructor"&&l.push(d);return l}function sa(n){var l=da(n);return l.length==1&&l[0][2]?oi(l[0][0],l[0][1]):function(d){return d===n||Zn(d,n,l)}}function na(n,l){return xt(n)&&ai(l)?oi(Rt(n),l):function(d){var m=wa(d,n);return m===void 0&&m===l?Aa(d,n):pr(l,m,void 0,a|o)}}function aa(n){return function(l){return ri(l,n)}}function oa(n){if(typeof n=="string")return n;if(mr(n))return ti?ti.call(n):"";var l=n+"";return l=="0"&&1/n==-h?"-0":l}function la(n,l,d){var m=-1,A=rn,v=n.length,x=!0,R=[],N=R;if(d)x=!1,A=sn;else if(v>=r){var V=l?null:ca(n);if(V)return or(V);x=!1,A=dn,N=new dt}else N=l?[]:R;e:for(;++m<v;){var j=n[m],B=l?l(j):j;if(j=d||j!==0?j:0,x&&B===B){for(var G=N.length;G--;)if(N[G]===B)continue e;l&&N.push(B),R.push(j)}else A(N,B,d)||(N!==R&&N.push(B),R.push(j))}return R}function ii(n){return $e(n)?n:ya(n)}var ca=Be&&1/or(new Be([,-0]))[1]==h?function(n){return new Be(n)}:Ta;function si(n,l,d,m,A,v){var x=A&o,R=n.length,N=l.length;if(R!=N&&!(x&&N>R))return!1;var V=v.get(n);if(V&&v.get(l))return V==l;var j=-1,B=!0,G=A&a?new dt:void 0;for(v.set(n,l),v.set(l,n);++j<R;){var le=n[j],ce=l[j];if(m)var Ee=x?m(ce,le,j,l,n,v):m(le,ce,j,n,l,v);if(Ee!==void 0){if(Ee)continue;B=!1;break}if(G){if(!nn(l,function(Se,Ne){if(!G.has(Ne)&&(le===Se||d(le,Se,m,A,v)))return G.add(Ne)})){B=!1;break}}else if(!(le===ce||d(le,ce,m,A,v))){B=!1;break}}return v.delete(n),v.delete(l),B}function ha(n,l,d,m,A,v,x){switch(d){case $:if(n.byteLength!=l.byteLength||n.byteOffset!=l.byteOffset)return!1;n=n.buffer,l=l.buffer;case H:return!(n.byteLength!=l.byteLength||!m(new ei(n),new ei(l)));case f:case y:case K:return li(+n,+l);case b:return n.name==l.name&&n.message==l.message;case ie:case C:return n==l+"";case T:var R=fn;case S:var N=v&o;if(R||(R=or),n.size!=l.size&&!N)return!1;var V=x.get(n);if(V)return V==l;v|=a,x.set(n,l);var j=si(R(n),R(l),m,A,v,x);return x.delete(n),j;case q:if(dr)return dr.call(n)==dr.call(l)}return!1}function ua(n,l,d,m,A,v){var x=A&o,R=yr(n),N=R.length,V=yr(l),j=V.length;if(N!=j&&!x)return!1;for(var B=N;B--;){var G=R[B];if(!(x?G in l:ye.call(l,G)))return!1}var le=v.get(n);if(le&&v.get(l))return le==l;var ce=!0;v.set(n,l),v.set(l,n);for(var Ee=x;++B<N;){G=R[B];var Se=n[G],Ne=l[G];if(m)var di=x?m(Ne,Se,G,l,n,v):m(Se,Ne,G,n,l,v);if(!(di===void 0?Se===Ne||d(Se,Ne,m,A,v):di)){ce=!1;break}Ee||(Ee=G=="constructor")}if(ce&&!Ee){var Mt=n.constructor,Dt=l.constructor;Mt!=Dt&&"constructor"in n&&"constructor"in l&&!(typeof Mt=="function"&&Mt instanceof Mt&&typeof Dt=="function"&&Dt instanceof Dt)&&(ce=!1)}return v.delete(n),v.delete(l),ce}function Ct(n,l){var d=n.__data__;return fa(l)?d[typeof l=="string"?"string":"hash"]:d.map}function da(n){for(var l=yr(n),d=l.length;d--;){var m=l[d],A=n[m];l[d]=[m,A,ai(A)]}return l}function Ge(n,l){var d=pn(n,l);return ea(d)?d:void 0}var ke=Jn;(cr&&ke(new cr(new ArrayBuffer(1)))!=$||ht&&ke(new ht)!=T||hr&&ke(hr.resolve())!=te||Be&&ke(new Be)!=S||ur&&ke(new ur)!=k)&&(ke=function(n){var l=Ve.call(n),d=l==J?n.constructor:void 0,m=d?Re(d):void 0;if(m)switch(m){case wn:return $;case An:return T;case In:return te;case Tn:return S;case kn:return k}return l});function pa(n,l,d){l=xt(l,n)?[l]:ii(l);for(var m,A=-1,x=l.length;++A<x;){var v=Rt(l[A]);if(!(m=n!=null&&d(n,v)))break;n=n[v]}if(m)return m;var x=n?n.length:0;return!!x&&gr(x)&&ni(v,x)&&($e(n)||ci(n))}function ni(n,l){return l=l==null?u:l,!!l&&(typeof n=="number"||Zs.test(n))&&n>-1&&n%1==0&&n<l}function xt(n,l){if($e(n))return!1;var d=typeof n;return d=="number"||d=="symbol"||d=="boolean"||n==null||mr(n)?!0:Ks.test(n)||!Ws.test(n)||l!=null&&n in Object(l)}function fa(n){var l=typeof n;return l=="string"||l=="number"||l=="symbol"||l=="boolean"?n!=="__proto__":n===null}function ga(n){return!!Qr&&Qr in n}function ma(n){var l=n&&n.constructor,d=typeof l=="function"&&l.prototype||Et;return n===d}function ai(n){return n===n&&!$t(n)}function oi(n,l){return function(d){return d==null?!1:d[n]===l&&(l!==void 0||n in Object(d))}}var ya=fr(function(n){n=Sa(n);var l=[];return zs.test(n)&&l.push(""),n.replace(Ys,function(d,m,A,v){l.push(A?v.replace(Qs,"$1"):m||d)}),l});function Rt(n){if(typeof n=="string"||mr(n))return n;var l=n+"";return l=="0"&&1/n==-h?"-0":l}function Re(n){if(n!=null){try{return Xr.call(n)}catch{}try{return n+""}catch{}}return""}function ba(n,l){return n&&n.length?la(n,ra(l)):[]}function fr(n,l){if(typeof n!="function"||l&&typeof l!="function")throw new TypeError(i);var d=function(){var m=arguments,A=l?l.apply(this,m):m[0],v=d.cache;if(v.has(A))return v.get(A);var x=n.apply(this,m);return d.cache=v.set(A,x),x};return d.cache=new(fr.Cache||ve),d}fr.Cache=ve;function li(n,l){return n===l||n!==n&&l!==l}function ci(n){return va(n)&&ye.call(n,"callee")&&(!vn.call(n,"callee")||Ve.call(n)==p)}var $e=Array.isArray;function hi(n){return n!=null&&gr(n.length)&&!ui(n)}function va(n){return Nt(n)&&hi(n)}function ui(n){var l=$t(n)?Ve.call(n):"";return l==E||l==P}function gr(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=u}function $t(n){var l=typeof n;return!!n&&(l=="object"||l=="function")}function Nt(n){return!!n&&typeof n=="object"}function mr(n){return typeof n=="symbol"||Nt(n)&&Ve.call(n)==q}var _a=Jr?un(Jr):ta;function Sa(n){return n==null?"":oa(n)}function wa(n,l,d){var m=n==null?void 0:ri(n,l);return m===void 0?d:m}function Aa(n,l){return n!=null&&pa(n,l,Qn)}function yr(n){return hi(n)?Yn(n):ia(n)}function Ia(n){return n}function Ta(){}function ka(n){return xt(n)?cn(Rt(n)):aa(n)}e.exports=ba})($r,$r.exports);var fc=$r.exports;export{hc as a,de as b,zt as c,pc as d,Hl as e,nc as g,uc as i,cc as l,ac as s,fc as u};
